<%assign var="p" value=$nextmodel->getPublishJson($pageId)|json_decode:true%>
<%assign var="platform" value="打印"%>
<%if $smarty.get.view == "wechat"%>
    <%assign var="bodyClass" value="wechat-pdf"%>
    <%assign var="platform" value="微信"%>
<%/if%>
<!DOCTYPE html>
<html class="no-js core">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Language" content="zh-CN"/>
        <title><%$p.meta.title%> - <%$platform%>版 - <%$smarty.now|date_format:"%Y年%m月%d日"%></title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <%*<!--MARK: - Switch between different themes-->*%>
        <style><%include file="next/styles/main-story-partner-content.css"%></style>
        <style>
            body {
                font-family: "Helvetica Neue","Verdana","Arial","Hiragino Sans GB","WenQuanYi Micro Hei","Heiti SC",STHeiti,"Microsoft Yahei",SimSun,"Hiragino Sans TC","Microsoft JhengHei",PMingLiU,sans-serif;
                font-size: 16px;
                margin: 0 auto;
                display: block;
                background: white !important;
            }
            body.wechat-pdf {
                font-size: 32px;
            }
            img {
                max-width: 100%;
                display:block;
            }
            .page-container {
                margin: auto;
                max-width: 728px;
            }
            .cover-page {
                page-break-after: always;
            }
            .page-title {
                text-align: center;
                line-height: 120%;
                font-size: 1.6em;
            }
            .publish-date {
                text-align: center;
                line-height: 120%;
                font-size: 1em;
                margin-top: 20px;
            }
            .content-title {
                font-size: 1.2em;
                text-align: center;
                line-height: 120%;
                margin-top: 20px;
            }
            .content-headline {
                font-size: 1.2em;
                font-weight: bold;
                text-align: center;
                line-height: 120%;
                margin-top: 20px;
                display: block;
                color: black !important;
            }
            .list-title-print {
                font-size: 1.2em;
                font-weight: bold;
                color: #0f5499;
                line-height: 140%;
            }
            .article-container {
                page-break-after: always;
            }
            .chinese-headline {
                line-height: 140%;
                font-weight: bold;
                font-size: 1.2em;
            }
            .english-headline {
                line-height: 140%;
            }
            .article-url {
                font-size: 0.8em;
            }
            .article-image {
                margin: 30px 0;
            }
            .article-body p {
                margin-bottom: 1em;
                line-height: 140%;
                text-align: justify;
            }
            .article-body h1 {
                font-size: 1.2em;
            }
            .pic {
                margin-bottom: 1em;
                font-size: 0.9em;
                color: #555555;
            }
            a {
                color: black;
                text-decoration: none;
            }

            @media print {
                .pic, img {
                    break-inside: avoid;
                }
            }

        </style>
    </head>
    <body class="<%$bodyClass%>">
        <div class="page-container">
        <%foreach from=$p.sections item=section%>
            <%if $section.type == "MainMessage"%>
                <div class="cover-page">
                    <h1 class="page-title"><%$section.title%></h1>
                    <h1 class="page-title"><%$section.content%></h1>
                    <div class="publish-date"><%$smarty.now|date_format:"%Y年%m月%d日"%></div>
                    <div class="content-title">内容概览</div>
                    <%foreach from=$p.sections item=newSection%>
                        <%if $newSection.type == "block"%>
                            <%foreach from=$newSection.lists item=list%>
                                <%foreach from=$list.items item=item%>
                                        <a href="#id<%$item.id%>" class="content-headline"><%$item.headline%></a>
                                <%/foreach%>
                            <%/foreach%>
                        <%/if%>
                    <%/foreach%>
                </div>
            <%/if%>
            <%if $section.type == "block"%>
                <%foreach from=$section.lists item=list%>
                    <h2 class="list-title-print"><%$list.title%></h2>
                    <%foreach from=$list.items item=item%>
                        <div class="article-container" id="id<%$item.id%>">
                            <div class="chinese-headline"><%$item.headline%></div>
                            <%assign var="contentInfo" value=$storymodel->getContentById($item.id)%>
                            <div class="english-headline"><%$contentInfo.eheadline%></div>
                            <%if $item.id != ""%>
                                <div class="article-url">原文地址：https://www.ftchinese.com/<%$item.type%>/<%$item.id%></div>
                            <%/if%>
                            <%if $item.image != ""%>
                                <div class="article-image"><img src="<%$item.image|replace:"/upload/":"/"|replace:"/unsafe/picture/":"/unsafe/728x0/picture/"%>"></div>
                            <%/if%>
                            <%assign var="storyBody" value=$contentInfo.cbody%>
                            <%assign var="storyBody" value=$storyBody|regex_replace:"/<p>[_-]+<\/p>/":"<hr/><br/>"%>
                            <%if $item.type == "interactive"%>
                                <%assign var="storyBody" value=$storyBody|regex_replace:"/[\r\t\n]+/":"</p>\n<p>"%>
                                <%assign var="storyBody" value="\n<p>`$storyBody`</p>\n"%>
                                <%assign var="storyBody" value=$storyBody|regex_replace:"/\<p\>(\<div.*\<\/div\>)[\r\t\n]*<\/p\>/":"\\1"%>
                                <%assign var="storyBody" value=$storyBody|regex_replace:"/\<p\>\ *\<\/p\>/":""%>
                                <%assign var="storyBody" value=$storyBody|regex_replace:"/\<p\>\<\/p\>/":""%>
                            <%/if%>
                            
                            <div class="article-body">
                                <%if $storyBody != ""%>
                                    <%$storyBody%>
                                <%else%>
                                    <%$item.longlead|regex_replace:"/[\r\t\n]+/":"</p>\n<p>"%>
                                <%/if%>
                            </div>
                            
                        </div>
                    <%/foreach%>
                <%/foreach%>
            <%/if%>
        <%/foreach%>
        </div>
    </body>
</html>
