<%assign var="useSafariToOpenSponsorStory" value="no"%>
<%assign var="adForceString" value=""%>
<%if $topnav != "home" && $topnav != ""%>
    <%assign var="adForceString" value="?topnav=`$topnav`"%>
    <%if $subnav != ""%>
    	<%assign var="adForceString" value="`$adForceString`&subnav=`$subnav`"%>
	    <%if $thirdnav != ""%>
	    	<%assign var="adForceString" value="`$adForceString`&thirdnav=`$thirdnav`"%>
	    <%/if%>
    <%/if%>
<%/if%>
<%assign var="listHasFloat" value="none"%>
<%assign var="sideListCount" value=0%>
<%assign var="listForImage" value=""%>
<%foreach from=$section.lists item=list%>
	<%if $list.float === "left" || $list.float === "right" || $list.float === "SideBySide" || $list.float === "SplitList" || $list.float === "BiligualFullText"%>
	<%assign var="listHasFloat" value="`$list.float`"%>
	<%/if%>
	<%if $list.type != "" && $list.type != "list" && $list.type != "listForImage" && $list.type != "listWithText"%>
		<%assign var="sideListCount" value=$sideListCount+1%>
	<%/if%>
	<%if $list.type == "listForImage"%>
		<%assign var="listForImage" value=" list-for-image-container"%>
	<%/if%>
<%/foreach%>
<%if $listForImage != ""%>
	<style><%include file="next/styles/main-list-for-image.css"%></style>
<%/if%>
<%if $listHasFloat == "BiligualFullText"%>
	<style><%include file="next/styles/main-bilingual-full-text.css"%></style>
	<div class="overlay-container" id="overlay-news-preference">
	<div class="overlay-inner">
	<div class="overlay-bg-fixed" data-parentid="overlay-login"></div>
	<div class="overlay-content-outer">
	<div class="overlay-content-inner">
	<div class="overlay-content">
	<div class="overlay-title">请选择您的译文显示偏好</div>
	<span class="preference-selection" id="translation-display-preference">
		<div data-translation="none">
			<b>不显示中文</b>
			<p>只显示英文部分，隐藏中文译文</p>
		</div>
		<div data-translation="human">
			<b>只显示人工确认的译文</b>
			<p>只显示人工已经确认的译文，可能多数新闻仅有英文部分</p>
		</div>
		<div data-translation="both">
			<b>显示所有译文</b>
			<p>在没有人工译文的情况下显示机器翻译的译文作为参考</p>
		</div>
	</span>
	<div class="wx-login-container">
		<div class="login-btn input-submit-container center">
			<input id="confirm-translation-preference" class="disabled" type="submit" value="确定">
		</div>
	</div>
	</div>
	</div>
	</div>
	</div>
	</div>
<%/if%>
<%assign var="visibleOnlyClass" value=""%>
<%if $smarty.get.webview != "ftcapp"%>
	<%assign var="visibleOnlyClass" value=" `$section.VisibleOnlyTo`"%>
<%/if%>
<div class="block-container<%if $section.boxBackground != ""%> <%$section.boxBackground%><%/if%> <%if ($section.side != "" && $section.side != "none" && $section.side != "Narrow") || $sideListCount > 0 %><%assign var="sectionHasSide" value="yes"%>has-side<%if $section.sideAlign !== ""%> side-<%$section.sideAlign|default:"right"%><%/if%><%else%><%assign var="sectionHasSide" value="no"%>no-side<%/if%><%if $section.side == "HotVideos"%> side-video<%/if%><%if $section.side == "Narrow"%> narrow-block<%/if%><%$visibleOnlyClass%>"><div class="block-inner">
<div class="content-container">
	<%*<!-- MARK: - This doesn't seem to be in use! Remove after Jan 1, 2021! -->*%>
	<%*<!-- include file="next/partials/full-screen-subscribe-hint.html" -->*%>
	<div class="content-inner<%$listForImage%>">
		<%if $section.title != ""%>
			<div class="block-title"><%$section.title%></div>
		<%/if%>
		<%if $section.description != ""%>
			<div class="items">
				<div class="no-image">
					<div class="item-inner">
						<div class="item-lead"><%$section.description%></div>
					</div>
				</div>
			</div>
		<%/if%>
		<%assign var="l" value=0%>
		<%assign var="listLength" value=$section.lists|@count%>
		<%assign var="foundConfirmForm" value="no"%>
		<%foreach from=$section.lists item=list%>
			<%if $list.float === "LargeCard" || $list.float === "GridCard"%>
				<%*<!--MARK: - Start to use CSS grid for any new styles -->*%>
				<%include file="next/partials/ListGrid.html"%>
			<%else%>
				<%assign var="listType" value=""%>
				<%assign var="listClass" value=""%>
				<%if $list.feedType == "job"%>
					<%include file="next/partials/job.html"%>
				<%elseif $list.type == "subscriptionPromotion"%>
					<%include file="next/partials/subscriptionPromotion.html"%>
				<%elseif $list.type == "SubscriptionInfoConfirm"%>
					<%if $foundConfirmForm == "no" && (preg_match("/`$currentDate`/is",$list.dates) || $list.dates == "") && ($list.status == "on" || $debug_model == 1) && ($list.membership == "" || ($smarty.get.membership != "" && preg_match("/,`$smarty.get.membership`,/is",",`$list.membership`,"))) && ($list.action == "" || ($smarty.get.action != "" && preg_match("/,`$smarty.get.action`,/is",",`$list.action`,")))%>
						<%assign var="foundConfirmForm" value="yes"%>
						<%include file="next/partials/SubscriptionInfoConfirm.html"%>
					<%/if%>
				<%elseif $list.type == "listWithText"%>
					<%include file="next/partials/listWithText.html"%>
				<%elseif $list.type == "listForImage"%>
					<%include file="next/partials/listForImage.html"%>
				<%elseif $list.type == "EventApplication"%>
					<%include file="next/partials/EventApplication.html"%>
				<%elseif $list.type == "ActivityContainer"%>
					<%include file="next/partials/ActivityContainer.html"%>
				<%elseif $list.type == "MyProducts"%>
					<%include file="next/partials/MyProducts.html"%>
				<%elseif $list.type == "listWithCode"%>
					<%if $list.codeFileName != ""%>
						<%include file="next/partials/`$list.codeFileName`.html"%>
					<%/if%>
				<%elseif $list.type == "" || $list.type == "list"%>
					<%assign var="listTop" value=""%>
					<%assign var="listTopClass" value=""%>
					<%if $list.float == "none" && (($list.items|@count >= 6 && $list.items[0].type === 'video' && $list.items[1].type === 'video' && $list.items[2].type === 'video' && $list.items[3].type === 'video' && $list.items[4].type === 'video' && $list.items[5].type === 'video') || ($list.feedType=="video" && $list.feedItems == 6))%>
						<%if $l == $listLength-1%>
							<%assign var="listLastChildClass" value=" last-child"%>
						<%else%>
							<%assign var="listLastChildClass" value=""%>
						<%/if%>
						<%assign var="listClass" value=" video-package`$listLastChildClass`"%>
						<%assign var="listType" value="videos"%>
					<%elseif $listHasFloat === "left" || $listHasFloat === "right"%>
						<%*<!--Layout of side and main lists-->*%>
						<%if $list.float === "oneline"%>
							<%assign var="listClass" value=" XL-list-oneline L-list-oneline"%>
							<%assign var="listType" value="oneline"%>
						<%elseif $list.float === "left" || $list.float === "right"%>
							<%assign var="listClass" value=" XL-list-`$list.float` XL-side L-list-`$list.float` L-side"%>
							<%assign var="listType" value="side"%>
						<%elseif $listHasFloat === "left"%>
							<%assign var="listClass" value=" XL-list-right XL-main L-list-right L-main"%>
							<%assign var="listType" value="main"%>
						<%else%>
							<%assign var="listClass" value=" XL-list-left XL-main L-list-left L-main"%>
							<%assign var="listType" value="main"%>
						<%/if%>
					<%elseif $listHasFloat === "SideBySide"%>
						<%*<!--Layout of side-by-side lists-->*%>
						<%if $list.float === "SideBySide"%>
							<%if $sectionHasSide == "yes"%>
								<%assign var="listClass" value=" XL4 L6 M12 S6 P12 side-by-side"%>
								<%if $l%3 === 0 %>
									<%assign var="listTopClass" value="XLC"%>
								<%/if%>
								<%if $l%2 === 0 %>
									<%assign var="listTopClass" value="`$listTopClass` LC SC"%>
								<%/if%>
								<%assign var="listTopClass" value="`$listTopClass` MC PC"%>
							<%else%>
								<%assign var="listClass" value=" XL3 L4 M6 S6 P12 side-by-side"%>
								<%if $l%4 === 0 %>
									<%assign var="listTopClass" value="XLC"%>
								<%/if%>
								<%if $l%3 === 0 %>
									<%assign var="listTopClass" value="`$listTopClass` LC"%>
								<%/if%>
								<%if $l%2 === 0 %>
									<%assign var="listTopClass" value="`$listTopClass` MC SC"%>
								<%/if%>
								<%assign var="listTopClass" value="`$listTopClass` PC"%>
							<%/if%>
						<%else%>
							<%assign var="listClass" value=" XL-oneline"%>
						<%/if%>
					<%elseif $listHasFloat === "SplitList"%>
						<%*<!--Layout of SplitList-->*%>
						<%if $list.float === "SplitList"%>
							<%if $sectionHasSide == "yes"%>
								<%assign var="listClass" value=" split-list"%>
								<%if $l%2 === 0 %>
									<%assign var="listTopClass" value="`$listTopClass` XLC LC"%>
								<%/if%>
								<%assign var="listTopClass" value="`$listTopClass` MC SC PC"%>
							<%else%>
								<%assign var="listClass" value=" split-list"%>
								<%if $l%2 === 0 %>
									<%assign var="listTopClass" value="`$listTopClass` XLC LC MC SC"%>
								<%/if%>
								<%assign var="listTopClass" value="`$listTopClass` PC"%>
							<%/if%>
						<%else%>
							<%assign var="listClass" value=" XL-oneline"%>
						<%/if%>
					<%elseif $list.float === "BiligualFullText"%>
						<%*<!--Layout of BiligualFullText-->*%>
						<%assign var="listClass" value=" XL-oneline XL-list-oneline L-list-oneline"%>
						<%assign var="listTopClass" value=""%>
						<%* <!--end BiligualFullText -->*%>
					<%/if%>

					<%if $list.feedType === "myFTNew"%>
						<%assign var="listClass" value="`$listClass` list-my-ft"%>
						<%assign var="isMyFTOn" value="yes"%>
					<%/if%>

					<%assign var="prev" value=$l-1%>
					<%if $listTopClass !== "" && $l > 0%>
						<%assign var="listTop" value="<div class=\"`$listTopClass`\"></div>"%>
					<%/if%>
					<%if $list.url != ""%>
						<%if preg_match("/http|\//is",$list.url)%>
							<%assign var=listUrl value=$list.url%>
						<%else%>
							<%assign var=listUrl value="/tag/`$list.url`"%>
						<%/if%>
					<%else%>
						<%assign var=listUrl value="#"%>
					<%/if%>
					<%$listTop%>
					<%*<!--combine side lists-->*%>
					<%if $listHasFloat === "none" || $listHasFloat === "SideBySide" || $listHasFloat === "SplitList" || $l==0 || ($prev >= 0 && $list.float != $section.lists[$prev].float)%><div class="list-container<%$listClass%>"><div class="list-inner"><%/if%>
						<%if $list.title != ""%>
							<h2 class="list-title">
								<a class="list-link<%if $list.title == " "%> empty<%/if%>" href="<%$listUrl%>"><%$list.title%></a>
								<%if $list.sponsorLogoUrl != ""%>
									<a class="sponsor-link" target=_blank href="<%$list.sponsorLink|default:"#"%>"><figure class="loading sponsor" data-url="<%$list.sponsorLogoUrl|replace:"/upload/":"/"%>"></figure></a>
								<%/if%>
							</h2>
						<%elseif $l > 0%>
							<h2 class="list-title">
								<a class="list-link empty"></a>
							</h2>
						<%/if%>

						<%if $list.description != ""%>
						<div class="items">
							<div class="no-image">
								<div class="item-inner">
									<div class="item-lead"><%$list.description%></div>
								</div>
							</div>
						</div>
						<%/if%>

						<%if $list.sponsorLogoUrl != ""%>
							<%assign var=stickTop value="44px"%>
							<%if $smarty.get.webview === "ftcapp"%>
								<%assign var=stickTop value="0"%>
							<%/if%>
							<style>
								.sponsor-logo-sticky {
									position:sticky;
									top:<%$stickTop%>;
									z-index:1;
								}
							</style>
							<a href="<%$list.sponsorLink%>" target="_blank" class="sponsor-logo-sticky P-only"><img src="<%$list.sponsorLogoUrl%>"></a>
						<%/if%>

						<%if $list.sponsorAdId != "" && 0>1%>
							<div class="sponsor-container"><div class="bn-ph"><div class="banner-container">
							<div class="banner-inner">
							<div style="line-height:90px;text-align:center;font-size:2em;background-color:black;color: white;">IBM</div>
							</div>
							<%*<!--
							<iframe id="mpu3Frame" name="mpu3Frame" width="100%" height="90" frameborder="0" scrolling="no" marginwidth="0" marginheight="0" src="/m/marketing/<%$adFileName%>.html#adid=<%$p.meta.adid%><%$banners[$bannerCount]%>&slot=986723212"></iframe>
							-->*%>
							</div></div></div>
						<%/if%>

						<div class="items">

						<%if preg_match("/all|story|interactive|photo|video|premium/is",$list.feedType) && $list.items|@count==0%>
							<%if $list.feedImage == "necessary"%>
								<%assign var="feedImage" value="necessary"%>
							<%/if%>
							<%assign var="feedRepeatCheck" value="yes"%>
							<%assign var="feedItems" value=$list.feedItems*4%>
						<%else%>
							<%assign var="feedImage" value="optional"%>
							<%assign var="feedRepeatCheck" value="no"%>
							<%assign var="feedItems" value=$list.feedItems%>
						<%/if%>
						<%*<!--feed type is <%$feedType%>, feed repeat check is <%$feedRepeatCheck%>-->*%>

						<%assign var="actualFeedItems" value=$list.feedItems%>
						<%assign var="feedStart" value=$list.feedStart|default:0%>
						<%assign var="pageNumber" value=$smarty.get.p%>
						<%if $pageNumber > 1%>
							<%assign var="feedStart" value=$pageNumber-1%>
							<%if $actualFeedItems > 0%>
								<%assign var="feedStart" value=$feedStart*$actualFeedItems%>
							<%/if%>
						<%/if%>
						<%assign var="feedTag" value=$list.feedTag%>
						
						<%if $list.feedItems == "" || $list.feedItems == "0" || $list.feedItems == 0%>
							<%*<!--MARK: - If feedItems is not set, no need to run sql request. -->*%>
							<%assign var="feedType" value="manual"%>
							<%assign var="itemsArray" value=$list.items%>
						<%elseif $list.feedType == "myFT"%>
							<%easyapi command="31005" assign="myftArrays" topnum=30%>
							<%assign var="itemsArray" value=$myftArrays.odatalist%>
						<%elseif $list.feedType == "hot"%>
							<%assign var="itemsArray" value=$storymodel->get_hot_story(7,40,true)%>
							<%assign var="feedType" value=$list.feedType%>
						<%elseif $list.feedType == "myFTNew"%>
							<%assign var="feedType" value=$list.feedType%>
							<%assign var="itemsArray" value=$storymodel->get_content_by_field_search('1>0',$feedStart,$feedItems,600,10800)%>
						<%elseif $list.feedType == "ftc_columns"%>
							<%assign var="itemsArray" value=$storymodel->get_column_list("cn")%>
							<%assign var="feedType" value="columns"%>
						<%elseif $list.feedType == "ft_columns"%>
							<%assign var="itemsArray" value=$storymodel->get_column_list("en")%>
							<%assign var="feedType" value="columns"%>
						<%elseif $list.items|@count==0 && $list.feedItems != "" && $list.feedItems != "0"%>
							<%if preg_match("/like|find_in_set|=|\(| in /is",$feedTag)%>
								<%if $list.feedType == "story"%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="feedTag" value="(`$feedTag`) and eskylinetext not like '%低调%'"%>
									<%assign var="itemsArray" value=$storymodel->get_story_by_field_search($feedTag,$feedStart,$feedItems,600,10800)%>
								<%elseif $list.feedType == "interactive"%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="itemsArray" value=$interactivemodel->get_interactive_by_field_search($feedTag,$feedStart,$feedItems,600,10800)%>
								<%elseif $list.feedType == "video"%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="itemsArray" value=$videomodel->get_video_by_field_search($feedTag,$feedStart,$feedItems,600,10800)%>
								<%elseif $list.feedType == "photo"%>
									<%assign var="feedType" value="photonews"%>
									<%assign var="itemsArray" value=$photonewsmodel->get_photonews_by_field_search($feedTag,"ORDER BY photonewsid DESC",$feedItems)%>
								<%else%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="feedTag" value="(`$feedTag`) and eskylinetext not like '%低调%'"%>
									<%assign var="itemsArray" value=$storymodel->get_content_by_field_search($feedTag,$feedStart,$feedItems,600,10800)%>
								<%/if%>
							<%else%>
								<%if $list.feedType == "story"%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="itemsArray" value=$storymodel->get_story_by_tag($feedTag,$feedStart,$feedItems)%>
								<%elseif $list.feedType == "interactive"%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="interactiveFeedSQL" value="find_in_set('`$feedTag`', tag)"%>
									<%assign var="itemsArray" value=$interactivemodel->get_interactive_by_field_search($interactiveFeedSQL,$feedStart,$feedItems,600,10800)%>
								<%elseif $list.feedType == "aiaudio"%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="itemsArray" value=$interactivemodel->get_ai_audios($list.language, $list.feedStart, $list.feedItems)%>
								<%elseif $list.feedType == "video"%>
									<%assign var="feedType" value=$list.feedType%>
									<%if preg_match("/^[0-9]+$/is",$feedTag)%>
										<%assign var="videoChannel" value=$feedTag%>
										<%assign var="itemsArray" value=$videomodel->get_video_by_channel($videoChannel,$feedStart,$feedItems)%>
									<%else%>
										<%assign var="itemsArray" value=$videomodel->get_video_by_tag($feedTag,$feedStart,$feedItems)%>
									<%/if%>
								<%elseif $list.feedType == "photo"%>
									<%assign var="feedType" value="photonews"%>
									<%assign var="itemsArray" value=$photonewsmodel->get_photonews_by_tag($feedTag,0,$feedItems)%>
								<%elseif $list.feedType == "premium"%>
									<%*<!--Premium Content Should Display -->*%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="itemsArray" value=$storymodel->getPremiumStory($feedStart, $feedItems)%>
								<%elseif $list.feedType == "audiovideo"%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="itemsArray" value=$videomodel->get_video_audio($feedStart,$list.feedItems,600,10800)%>
								<%else%>
									<%assign var="feedType" value=$list.feedType%>
									<%*<!--MARK: - Note that getContentByTag's argument is different from other functions -->*%>
									<%assign var="itemsArray" value=$storymodel->getContentByTag($feedTag,$feedItems,$feedStart)%>
								<%/if%>
							<%/if%>
						<%else%>
							<%assign var="feedType" value="manual"%>
							<%assign var="itemsArray" value=$list.items%>
						<%/if%>


						<%*<!--MARK: Highlight FT Academy-->*%>
						<%if $b == 0 && $l == 0 && $highlightFTAcademy == "feed"%>
							<%assign var="ftAcademyItems" value=$interactivemodel->get_interactive_by_field_search("find_in_set('FT商学院', tag)",0,1,2,10800)%>
							<%php%>
								$originalItems = $this->get_template_vars('itemsArray');
								$insertedItems = $this->get_template_vars('ftAcademyItems');
								if (count($originalItems) > 3 && count($insertedItems) > 0) {
									foreach ($insertedItems as &$insertedItem) {
										$insertedItem["type"] = 'interactive';
									}
									array_splice( $originalItems, 1, 0, $insertedItems);
									$newIds = [];
									$newItems = [];
									foreach ($originalItems as $item) {
										$found_key = array_search($item["id"], $newIds);
										if (!$found_key) {
											array_push($newItems, $item);
											array_push($newIds, $item["id"]);
										}
									}
									$this->assign("itemsArray", $newItems);
								}
							<%/php%>
						<%/if%>

						<%if $maxItems == 0 || $maxItems == ""%>
							<%assign var="maxItems" value=96%>
						<%/if%>
						<%assign var="i" value=0%>
						<%if $feedRepeatCheck == "yes"%>
							<%foreach from=$itemsArray item=item%>
								<%if $i < $list.feedItems && $i < $maxItems%>
									<%if $feedType == "all"%>
										<%assign var="itemImage" value=$item.image.cover|default:$item.image.smallbutton|default:$item.image.other|default:$item.image.bigbutton%>
									<%elseif $feedType == "photonews"%>
										<%assign var="itemImage" value=$item.illustration|default:$item.cover|default:$item.thumb_url%>
										<%if $itemImage != ""%>
											<%assign var="itemImage" value="https://thumbor.ftacademy.cn/unsafe/`$itemImage`"%>
										<%/if%>
									<%else%>
										<%assign var="itemImage" value=$item.image|default:$item.story_pic.cover|default:$item.story_pic.smallbutton|default:$item.story_pic.other|default:$item.story_pic.bigbutton%>
									<%/if%>
									<%assign var="itemImage" value=$itemImage|replace:"http://i.ftimg.net/picture/":"https://thumbor.ftacademy.cn/unsafe/picture/"%>
									<%assign var="itemId" value=$item.id|default:$item.photonewsid%>
									<%if ($itemImage != "" || $feedImage != "necessary") && !in_array($itemId, explode(',',$itemIdsArray))%>
										<%assign var="i" value=$i+1%>
									<%elseif in_array($itemId, explode(',',$itemIdsArray))%>
										<%*<!--repeated item: <%$itemId%>-->*%>
									<%/if%>

								<%/if%>
							<%/foreach%>
							<%assign var="listItemCount" value=$i%>
							<%*<!--Display Only <%$listItemCount%> Items That should display: <%$feedType%>/<%$feedImage%>/<%$feedRepeatCheck%>-->*%>
						<%else%>
							<%foreach from=$itemsArray item=item%>
								<%assign var="itemId" value=$item.id|default:$item.photonewsid%>
								<%if !in_array($itemId, explode(',',$premiumContentIds)) && $i < $maxItems%>
									<%assign var="i" value=$i+1%>
								<%/if%>
							<%/foreach%>
							<%assign var="listItemCount" value=$i%>
						<%/if%>
						<%assign var="i" value=0%>

						<%if $list.float === "ScoreBoard"%>
							<style><%include file="next/styles/main-table.css"%></style>
							<div class="table-container">
							<table class=tablesorter id=box-table-a summary="职位列表">
								<thead>
								<tr>
								<th scope="col">测试题目</th>
								<th scope="col" title="WPM是指您的每分钟阅读单词量（WPM：Word Per Minute）。一般来说，WPM达到200就算是相当不错了。如果您想要在GRE或者GMAT中获得高分，你需要把WPM提高到300。如果您要去英语国家攻读研究生，您的WPM需要达到400才能比较轻松地胜任学业。
								">您的WPM*</th>
								<th scope="col" style="text-align:right">平均WPM</th>
								<th scope="col" style="text-align:right">您的用时</th>
								<th scope="col" style="text-align:right">时间</th>
								</tr>
								</thead>
								<tbody>
						<%/if%>
						
						<%*<!--MARK: - If the current page number is higher than 1, don't show mannual lists. -->*%>
						<%assign var="shouldShowListItems" value="yes"%>
						<%if $pageNumber > 1 && $feedType == "manual"%>
							<%assign var="shouldShowListItems" value="no"%>
						<%/if%>
						<%if $shouldShowListItems == "yes"%>
							<%foreach from=$itemsArray item=item%>
								<%assign var="itemHeadline" value=$item.headline|default:$item.cheadline|default:$item.cn_title%>
								<%assign var="itemHeadline" value=$itemHeadline|regex_replace:"/\-\|\-.*$/":""%>
								<%assign var="itemTag" value=""%>
								<%assign var="tagCanFollow" value="yes"%>
								<%assign var="itemTagsString" value=$item.tag|default:$item.tags|default:$item.tagname%>
								<%assign var="itemTagsString" value=$itemTagsString|replace:", ":","%>
								<%assign var="itemTags" value=","|explode:$itemTagsString%>
								<%assign var="itemTag" value=$itemTags[0]%>
								<%assign var="tagImage" value=""%>
								<%assign var="itemMainTag" value=$itemTags[0]%>
								<%*<!--Sometimes Editors Use Space in Tags-->*%>
								<%if $itemTag === "视频"%>
									<%assign var="itemTagLink" value="/channel/explainer.html"%>
									<%assign var="tagCanFollow" value="no"%>
								<%elseif $itemTag === "秒懂"%>
									<%assign var="itemTagLink" value="/channel/slides.html"%>
									<%assign var="tagCanFollow" value="no"%>
								<%elseif $itemTag === "音频"%>
									<%assign var="itemTagLink" value="/channel/audio.html"%>
								<%elseif $itemTag === "图辑"%>
									<%assign var="itemTagLink" value="/channel/slides.html"%>
									<%assign var="tagCanFollow" value="no"%>
								<%elseif $itemTag === "数据新闻"%>
									<%assign var="itemTagLink" value="/channel/datanews.html"%>
								<%elseif $itemTag === "速读"%>
									<%assign var="itemTagLink" value="/channel/speedread.html"%>
								<%elseif $itemTag === "FT商学院"%>
									<%assign var="itemTagLink" value="/channel/mba.html"%>
								<%elseif $feedType=="columns"%>
									<%assign var="itemTag" value=$item.author_name_cn%>
									<%assign var="itemTagLink" value="/column/`$itemId`"%>
									<%assign var="tagCanFollow" value="no"%>
									<%assign var="itemHeadline" value=$itemHeadline|replace:"《":""|replace:"》":""%>
								<%else%>
									<%assign var="itemTagLink" value="/tag/`$itemTag`"%>
								<%/if%>
								<%if $smarty.get.webview === "ftcapp"%>
									<%assign var="tagCanFollow" value="no"%>
								<%/if%>
								<%assign var="itemTagTitle" value=$itemTag%>
								<%*<!--If editor ticked prefer sponsor image, get image and link from database -->*%>
								<%assign var="hasFoundSponsorInfo" value="no"%>
								<%if $item.preferSponsorImage == "yes" && $itemMainTag != ""%>
									<%assign var="pageIdForSponsorshipManagement" value="sponsorshipmanagement"%>
									<%if $infoForSponsorships == ""%>
										<%assign var="infoForSponsorships" value=$nextmodel->getPublishJson($pageIdForSponsorshipManagement)|json_decode:true%>
									<%/if%>
									<%assign var="foundSponsorTag" value="no"%>
									<%foreach from=$infoForSponsorships.sections item=oneTag%>
										<%assign var="matchedTag" value="no"%>
										<%if $foundSponsorTag == "no" && $oneTag.status == "on" && $oneTag.dates != "" && preg_match("/`$currentDate`/is",$oneTag.dates) && $oneTag.imageHighlightBox != ""%>
											<%assign var="sponsorKeys" value=$oneTag.storyKeyWords%>
											<%if $sponsorKeys == ""%>
												<%assign var="sponsorKeys" value=$oneTag.tag%>
											<%else%>
												<%assign var="sponsorKeys" value=$sponsorKeys|regex_replace:"/, */":"|"%>
											<%/if%>
											
											<%foreach from=$itemTags item=oneItemTag%>
												<%if $matchedTag == "no" && preg_match("/`$sponsorKeys`/is",$oneItemTag)%>
													<%assign var="matchedTag" value="yes"%>
													<%assign var="itemMainTag" value=$oneTag.tag%>
													<%assign var="itemTag" value=$oneTag.tag%>
												<%/if%>
											<%/foreach%>
										<%/if%>
										<%if $foundSponsorTag == "no" && $oneTag.status == "on" && $oneTag.dates != "" && preg_match("/`$currentDate`/is",$oneTag.dates) && ($itemMainTag == $oneTag.tag || $itemMainTag == $oneTag.title || $matchedTag == "yes") && $oneTag.imageHighlightBox != ""%>
											<%assign var="foundSponsorTag" value="yes"%>
											<%assign var="hasFoundSponsorInfo" value="yes"%>
											<%assign var="tagImage" value=$oneTag.imageHighlightBox%>
											<%assign var="trackLink" value="/tag/`$oneTag.tag`"%>
											<%if $oneTag.link != ""%>
												<%assign var="itemTagLink" value=$oneTag.link%>
												<%assign var="trackLink" value=$oneTag.link%>
											<%elseif $oneTag.tag != ""%>
												<%assign var="itemTagLink" value="/tag/`$oneTag.tag`"%>
											<%/if%>
											<%if $oneTag.title != ""%>
												<%assign var="itemTagTitle" value=$oneTag.title%>
											<%/if%>
										<%/if%>
									<%/foreach%>
									<%assign var="pageIdForTagManagement" value="tagmanagement"%>
									<%if $infoForTagmanagement == ""%>
										<%assign var="infoForTagmanagement" value=$nextmodel->getPublishJson($pageIdForTagManagement)|json_decode:true%>
									<%/if%>
									<%if $foundSponsorTag == "no"%>
										<%foreach from=$infoForTagmanagement.sections item=oneTag%>
											<%assign var="sponsorKeys" value=$oneTag.storyKeyWords%>
											<%if $sponsorKeys == ""%>
												<%assign var="sponsorKeys" value=$oneTag.tag%>
											<%else%>
												<%assign var="sponsorKeys" value=$sponsorKeys|regex_replace:"/, */":"|"%>
											<%/if%>
											<%assign var="matchedTag" value="no"%>
											<%foreach from=$itemTags item=oneItemTag%>
												<%if $matchedTag == "no" && preg_match("/`$sponsorKeys`/is",$oneItemTag)%>
													<%assign var="matchedTag" value="yes"%>
													<%assign var="itemMainTag" value=$oneTag.tag%>
													<%assign var="itemTag" value=$oneTag.tag%>
												<%/if%>
											<%/foreach%>
											<%if $foundSponsorTag == "no" && ($itemMainTag == $oneTag.tag || $itemMainTag == $oneTag.title || $matchedTag == "yes") && $oneTag.imageHighlightBox != ""%>
												<%assign var="foundSponsorTag" value="yes"%>
												<%assign var="hasFoundSponsorInfo" value="yes"%>
												<%assign var="tagImage" value=$oneTag.imageHighlightBox%>
												<%assign var="trackLink" value="/tag/`$oneTag.tag`"%>
												<%if $oneTag.link != ""%>
													<%assign var="itemTagLink" value=$oneTag.link%>
													<%assign var="trackLink" value=$oneTag.link%>
												<%elseif $oneTag.tag != ""%>
													<%assign var="itemTagLink" value="/tag/`$oneTag.tag`"%>
												<%/if%>
												<%if $oneTag.title != ""%>
													<%assign var="itemTagTitle" value=$oneTag.title%>
												<%/if%>
											<%/if%>
										<%/foreach%>
									<%/if%>
								<%/if%>
								<%if $hasFoundSponsorInfo == "no" && $itemMainTag != ""%>
									<%if $infoForTagmanagement == ""%>
										<%assign var="infoForTagmanagement" value=$nextmodel->getPublishJson("tagmanagement")|json_decode:true%>
									<%/if%>
									<%assign var="foundSponsorTag" value="no"%>
									<%foreach from=$infoForTagmanagement.sections item=oneTag%>
										<%if $foundSponsorTag == "no" && ($itemMainTag == $oneTag.tag || $itemMainTag == $oneTag.tag)%>
											<%assign var="foundSponsorTag" value="yes"%>
											<%if $oneTag.link != ""%>
												<%assign var="itemTagLink" value=$oneTag.link%>
											<%/if%>
											<%if $oneTag.title != ""%>
												<%assign var="itemTagTitle" value=$oneTag.title%>
											<%/if%>
										<%/if%>
									<%/foreach%>
								<%/if%>

								<%*<!--
								<%if $item.preferSponsorImage == "yes" && $itemMainTag != ""%>
									<%assign var="tagInteractive" value=$interactivemodel->get_interactive_by_field_search("find_in_set('特别报导',tag) and (cshortleadbody = '`$itemMainTag`' or cheadline = '`$itemMainTag`' or find_in_set('`$itemMainTag`',tag))",0,1,600,10800)%>
									<%if $tagInteractive|@count >0%>
										<%assign var="tagImage" value=$tagInteractive[0].story_pic.cover%>
										<%if $tagInteractive[0].cskylinetext != ""%>
											<%assign var="itemTagLink" value=$tagInteractive[0].cskylinetext%>
										<%elseif preg_match("/\//is",$tagInteractive[0].cshortleadbody)%>
											<%assign var="itemTagLink" value=$tagInteractive[0].cshortleadbody%>
										<%/if%>
									<%/if%>
								<%/if%>
								-->*%>

								<%*<!--item tag link: <%$itemTagLink%>-->*%>
								<%if $itemTag != ""%>
									<%*<!--MARK: MyFT is broken on web site, hide it now. -->*%>
									<%if $tagCanFollow == "yes"%>
										<%assign var="itemTag" value="<div class=item-tag><a href=\"`$itemTagLink`\">`$itemTagTitle`</a><button class=\"myft-follow plus\" data-tag=\"`$itemTag`\" data-type=\"tag\">关注</button></div>"%>
									<%else%>
										<%assign var="itemTag" value="<div class=item-tag><a href=\"`$itemTagLink`\">`$itemTagTitle`</a></div>"%>
									<%/if%>
								<%/if%>
								<%if $list.showTag !== "yes"%>
									<%assign var="itemTag" value=""%>
								<%/if%>

								<%if $list.feedImage == "hide"%>
									<%assign var="itemImage" value=""%>
								<%elseif $tagImage != ""%>
									<%assign var="itemImage" value=$tagImage%>
								<%elseif $feedType == "all"%>
									<!--story pic: <%$item.story_pic|@print_r%>--->
									<%assign var="itemImage" value=$item.image.cover|default:$item.image.smallbutton|default:$item.image.other|default:$item.image.bigbutton|default:$item.story_pic.cover|default:$item.story_pic.smallbutton|default:$item.story_pic.other|default:$item.story_pic.bigbutton%>
									<%*<!--MARK: - Don't try to optimize this! If you write this in one line, it won't work. This is one of the strange things about smarty. -->*%>
									<%if $itemImage == ""%>
										<%assign var="itemImage" value=$item.story_pic.cover|default:$item.story_pic.smallbutton|default:$item.story_pic.other|default:$item.story_pic.bigbutton%>
									<%/if%>
								<%elseif $feedType == "columns"%>
									<%assign var="columninfo" value=$storymodel->get_column_info($item.id)%>
									<%assign var="itemImage" value=$columninfo.piclink%>
								<%elseif $feedType == "photonews"%>
									<%assign var="itemImage" value=$item.illustration|default:$item.cover|default:$item.thumb_url%>
									<%if $itemImage != ""%>
										<%assign var="itemImage" value="https://thumbor.ftacademy.cn/unsafe/`$itemImage`"%>
									<%/if%>
								<%else%>
									<%assign var="itemImage" value=$item.image|default:$item.story_pic.cover|default:$item.story_pic.smallbutton|default:$item.story_pic.other|default:$item.story_pic.bigbutton%>
								<%/if%>
								<%assign var="itemImage" value=$itemImage|replace:"http://i.ftimg.net/picture/":"https://thumbor.ftacademy.cn/unsafe/picture/"%>
								<%assign var="itemId" value=$item.id|default:$item.photonewsid%>

								<%*<!--
									在不超过maxItems的前提下，符合以下条件的方可显示：
									1. 满足以下两个条件的：
									a. $feedRepeatCheck != "yes": 手动插入的，或是非story, interactive, photo类的auto feed
									b. $premiumContentIds中没有出现过的：目的是为了避免和subscription.html中已经出现的内容再次出现
									或者
									2. 同时满足下列几种条件：
									a. 在手动插入的item中没有出现过的item；
									b. feedItems大于0；
									c. 当前展示的item数量没有超过feedItems；
									d. 当前item配图，或者当前list不要求必须出图
								-->
								*%>
								<%if $i<$maxItems && (($feedRepeatCheck != "yes" && !in_array($itemId, explode(',',$premiumContentIds))) || (($feedImage != "necessary" || $itemImage != "") && $list.feedItems>0 && $i<$list.feedItems && !in_array($itemId, explode(',',$itemIdsArray))))%>
									<%*<!--<%$item|@print_r%>-->*%>
									<%assign var="itemType" value=$item.item_type|default:$item.type|default:$item.itemtype|default:$feedType%>
									<%if $itemType == "photo"%>
										<%assign var="itemType" value="photonews"%>
									<%elseif $itemType == "aiaudio"%>
										<%assign var="itemType" value="interactive"%>
									<%elseif preg_match("/accessright/is",$list.feedTag) || ($itemType == "story" && $item.accessright > 0)%>
										<%*<!--MARK: - If your sql search has accessright, it means you are searching for paid content only.  -->*%>
										<%assign var="itemType" value="premium"%>
									<%/if%>
									<%if $itemType == "premium" && $inSponsor == "yes"%>
										<%assign var="itemType" value="story"%>
									<%/if%>

									<%assign var="itemClass" value=""%>
									<%assign var="itemTop" value=""%>
									<%assign var="itemTopClass" value=""%>
									<%assign var="XL" value=""%>
									<%assign var="L" value=""%>
									<%assign var="M" value=""%>
									<%assign var="S" value=""%>
									<%assign var="P" value=""%>
									<%assign var="hasImage" value="has-image"%>
									<%assign var="hideImage" value="no"%>
									<%assign var="hideLead" value="no"%>
									<%if $listType === "videos"%>
										<%if $i === 0%>
											<%assign var="XL" value="XL2 L4 M4 S4 P4 on"%>
										<%else%>
											<%assign var="XL" value="XL2 L4 M4 S4 P4"%>
										<%/if%>
										<%if $i === 3%>
											<%assign var="itemTopClass" value="`$itemTopClass` LT MT ST"%>
										<%/if%>
										<%if $i>2%>
											<%assign var="P" value="P-hide"%>
										<%/if%>
										<%assign var="hideLead" value="yes"%>
									<%elseif $list.float === "ItemsWithSameImage"%>
										<%if $i === 0%>
											<%assign var="hideImage" value="no"%>
											<%assign var="XL" value="XL12 L12 M12 S12 P12"%>
											<%assign var="itemTopClass" value=""%>
										<%else%>
											<%assign var="hideImage" value="yes"%>
											<%assign var="XL" value="one-row"%>
											<%assign var="itemTopClass" value="XLT LT ST MT PT"%>
										<%/if%>
									<%elseif $list.float === "myFT"%>
										<%assign var="hideImage" value="yes"%>
										<%assign var="XL" value=""%>
										<%assign var="itemTopClass" value="XLT LT ST MT PT"%>
									<%elseif $list.float === "Headshot" ||  $list.float === "HeadshotSquare"%>
										<%assign var="XL" value="one-row headshot-lead"%>
										<%assign var="itemTopClass" value="XLT LT ST MT PT"%>
									<%elseif $list.float === "Card" || $list.float === "eBook"%>
										<%if $sectionHasSide == "yes"%>
											<%assign var="XL" value="XL4 L4 S12 M6 P12"%>
											<%if $i%3 == 0%>
												<%assign var="itemTopClass" value="`$itemTopClass` XLT LT"%>
											<%/if%>
											<%if $i%2 == 0%>
												<%assign var="itemTopClass" value="`$itemTopClass` MT"%>
											<%/if%>
											<%assign var="itemTopClass" value="`$itemTopClass` ST PT"%>
										<%else%>
											<%assign var="XL" value="XL3 L3 S4 M6 P12"%>
											<%if $i%4 == 0%>
												<%assign var="itemTopClass" value="`$itemTopClass` XLT LT"%>
											<%/if%>
											<%if $i%3 == 0%>
												<%assign var="itemTopClass" value="`$itemTopClass` ST"%>
											<%/if%>
											<%if $i%2 == 0%>
												<%assign var="itemTopClass" value="`$itemTopClass` MT"%>
											<%/if%>
											<%assign var="itemTopClass" value="`$itemTopClass` PT"%>
										<%/if%>
									<%elseif $list.float === "VideoWall"%>
											<%assign var="XL" value="XL6 L6 S6 M6 P6"%>
											<%if $i%2 == 0%>
												<%assign var="itemTopClass" value="clearfloat"%>
											<%/if%>
									<%elseif $feedType=="columns"%>
										<%if $sectionHasSide == "yes"%>
											<%assign var="XL" value="headshot-title XL4 L6 S12 M12 P12"%>
											<%if $i%3 == 0%>
												<%assign var="itemTopClass" value="`$itemTopClass` XLT LT"%>
											<%/if%>
											<%if $i%2 == 0%>
												<%assign var="itemTopClass" value="`$itemTopClass` LT"%>
											<%/if%>
											<%assign var="itemTopClass" value="`$itemTopClass` ST MT PT"%>
										<%else%>
											<%assign var="XL" value="headshot-title XL3 L4 S4 M6 P12"%>
											<%if $i%4 == 0%>
												<%assign var="itemTopClass" value="`$itemTopClass` XLT"%>
											<%/if%>
											<%if $i%3 == 0%>
												<%assign var="itemTopClass" value="`$itemTopClass` LT ST"%>
											<%/if%>
											<%if $i%2 == 0%>
												<%assign var="itemTopClass" value="`$itemTopClass` MT"%>
											<%/if%>
											<%assign var="itemTopClass" value="`$itemTopClass` PT"%>
										<%/if%>
									<%elseif $list.float === "IconTitle"%>
										<%if $sectionHasSide == "yes"%>
											<%assign var="XL" value="icon-title XL3 L3 S4 M6 P12"%>
											<%if $i%4 == 0%>
												<%assign var="itemTopClass" value="`$itemTopClass` XLT LT"%>
											<%/if%>
											<%if $i%3 == 0%>
												<%assign var="itemTopClass" value="`$itemTopClass` ST"%>
											<%/if%>
											<%if $i%2 == 0%>
												<%assign var="itemTopClass" value="`$itemTopClass` MT"%>
											<%/if%>
											<%assign var="itemTopClass" value="`$itemTopClass` PT"%>
										<%else%>
											<%assign var="XL" value="icon-title XL2 L2 S3 M4 P6"%>
											<%if $i%6 == 0%>
												<%assign var="itemTopClass" value="`$itemTopClass` XLT LT"%>
											<%/if%>
											<%if $i%4 == 0%>
												<%assign var="itemTopClass" value="`$itemTopClass` ST"%>
											<%/if%>
											<%if $i%3 == 0%>
												<%assign var="itemTopClass" value="`$itemTopClass` MT"%>
											<%/if%>
											<%if $i%2 == 0%>
												<%assign var="itemTopClass" value="`$itemTopClass` PT"%>
											<%/if%>
										<%/if%>
									<%elseif $sectionHasSide == "yes"%>
										<%if $list.float === "SideBySide"%>
											<%if $i > 0%>
												<%assign var="XL" value="side-by-side"%>
												<%assign var="hideImage" value="yes"%>
												<%assign var="hideLead" value="yes"%>
											<%else%>
												<%assign var="XL" value="side-by-side first"%>
											<%/if%>
										<%elseif $listType === "side"%>
											<%assign var="XL" value="XL-half"%>
											<%*<!--In X, side display one column-->*%>
											<%if $i !== 0%>
												<%assign var="itemTopClass" value="XLT"%>
											<%/if%>

											<%*<!--In L and S, side display two columns-->*%>
											<%if $i === 0 && $listItemCount % 2 === 1 %>
												<%assign var="L" value="L12"%>
												<%assign var="S" value="S12"%>
											<%else%>
												<%assign var="L" value="L6 L-half"%>
												<%assign var="S" value="S6 S-half"%>
											<%/if%>
											<%if ($listItemCount % 2 === 0 && $i%2 === 0) || ($listItemCount % 2 === 1 && $i%2 === 1)%>
												<%assign var="itemTopClass" value="`$itemTopClass` LT ST"%>
											<%/if%>

											<%*<!--In M and P, side display one column-->*%>
											<%if $l===0 && $i===0%>
												<%assign var="M" value="M12"%>
												<%assign var="P" value="P12"%>
											<%else%>
												<%assign var="M" value="M12 M-half"%>
												<%assign var="P" value="P12 P-half"%>
												<%assign var="itemTopClass" value="`$itemTopClass` MT PT"%>
											<%/if%>
										<%elseif $listType === "main"%>
											<%*<!--In XL, L and S, main display two columns-->*%>
											<%if $i === 0 && $l === 0 && $listItemCount % 2 === 1 %>
												<%assign var="XL" value="XL-cover"%>
												<%assign var="L" value="L-cover"%>
												<%assign var="S" value="S-cover"%>
											<%elseif $i === 0 && $listItemCount % 2 === 1 %>
												<%assign var="XL" value="XL12 XL-double-width"%>
												<%assign var="L" value="L12 L-double-width"%>
												<%assign var="S" value="S12 S-double-width"%>
											<%else%>
												<%assign var="XL" value="XL6 XL-half"%>
												<%assign var="L" value="L6 L-half"%>
												<%assign var="S" value="S6 S-half"%>
											<%/if%>
											<%if ($listItemCount % 2 === 1 && $i % 2 === 1) || ($listItemCount % 2 === 0 && $i % 2 === 0)%>
												<%assign var="itemTopClass" value="XLT LT ST"%>
											<%/if%>

											<%*<!--In M and P, main display one column-->*%>
											<%if $l===0 && $i===0%>
												<%assign var="M" value="M12"%>
												<%assign var="P" value="P12"%>
											<%else%>
												<%assign var="M" value="M12 M-half"%>
												<%assign var="P" value="P12 P-half"%>
												<%assign var="itemTopClass" value="`$itemTopClass` MT PT"%>
											<%/if%>
										<%else%>
											<%*<!--Has Side: XL Styles-->*%>
											<%if $listItemCount === 1%>
												<%assign var="XL" value="XL12"%>
											<%elseif $listItemCount === 2%>
												<%assign var="XL" value="XL6"%>
											<%elseif $listItemCount % 3 === 0 && $l === 0 && $list.items[0].image !== ""%>
												<%if $i === 0 %>
													<%assign var="XL" value="XL8"%>
												<%elseif $i===2 && $list.items[1].image !== ""%>
													<%if $list.preferLead == "none"%>
														<%assign var="XL" value="XL4 XL-right XL-no-tag"%>
													<%else%>
														<%assign var="XL" value="XL4 XL-right XL-half XL-no-tag"%>
													<%/if%>
												<%elseif $i===1%>
													<%if $list.float == "EqualSizeForNonFirstItems"%>
														<%assign var="XL" value="XL4 XL-half XL-right XL-no-tag"%>
													<%else%>
														<%assign var="XL" value="XL4 XL-right XL-no-tag"%>
													<%/if%>
												<%else%>
													<%assign var="XL" value="XL4"%>
												<%/if%>
												<%if $i % 3 === 0%>
													<%assign var="itemTopClass" value="XLT"%>
												<%/if%>
											<%elseif $listItemCount == 4%>
												<%assign var="XL" value="XL6"%>
												<%if $i % 2 === 0%>
													<%assign var="itemTopClass" value="XLT"%>
												<%/if%>
											<%elseif $listItemCount <= 5 && $l === 0 && $list.items[0].image !== ""%>
												<%if $i === 0 %>
													<%assign var="XL" value="XL8"%>
												<%elseif $i === 1 %>
													<%assign var="XL" value="XL4 XL-half XL-right XL-no-tag"%>
												<%else%>
													<%assign var="XL" value="XL4 XL-half XL-lower XL-right XL-no-tag"%>
												<%/if%>
											<%elseif $listItemCount % 3 === 1 && $l === 0 && $list.items[0].image !== ""%>
												<%if $i === 0 %>
													<%assign var="XL" value="XL8"%>
												<%elseif $i===2 && $list.items[1].image !== ""%>
													<%assign var="XL" value="XL4 XL-right XL-half XL-no-tag"%>
												<%elseif $i===1 && $list.float != "EqualSizeForNonFirstItems"%>
													<%assign var="XL" value="XL4 XL-right XL-no-tag"%>
												<%elseif $i >= $listItemCount - 4%>
													<%assign var="XL" value="XL6 XL-half"%>
												<%else%>
													<%assign var="XL" value="XL4"%>
												<%/if%>
												<%if ($i%3===0 && $i <= ($listItemCount - 4)) || $i === $listItemCount - 2%>
													<%assign var="itemTopClass" value="XLT"%>
												<%/if%>
											<%elseif $listItemCount % 3 === 2 && $l === 0 && $list.items[0].image !== ""%>
												<%if $i === 0 %>
													<%assign var="XL" value="XL8"%>
												<%elseif $i===2 && $list.items[1].image !== ""%>
													<%assign var="XL" value="XL4 XL-right XL-half XL-no-tag"%>
												<%elseif $i===1 && $list.float != "EqualSizeForNonFirstItems"%>
													<%assign var="XL" value="XL4 XL-right XL-no-tag"%>
												<%elseif $i >= ($listItemCount - 2)%>
													<%assign var="XL" value="XL6 XL-half"%>
												<%else%>
													<%assign var="XL" value="XL4"%>
												<%/if%>
												<%if $i%3===0%>
													<%assign var="itemTopClass" value="XLT"%>
												<%/if%>
											<%elseif $listItemCount % 3 == 0%>
												<%assign var="XL" value="XL4"%>
												<%if $i % 3 === 0%>
													<%assign var="itemTopClass" value="XLT"%>
												<%/if%>
											<%elseif $listItemCount % 3 == 1%>
												<%if $i === ($listItemCount - 1) %>
													<%assign var="XL" value="XL4 XL-half XL-lower"%>
												<%elseif $i === ($listItemCount - 2) %>
													<%assign var="XL" value="XL4 XL-half"%>
												<%else%>
													<%assign var="XL" value="XL4"%>
												<%/if%>
												<%if $i !== ($listItemCount - 1) && $i%3===0%>
													<%assign var="itemTopClass" value="XLT"%>
												<%/if%>
											<%elseif $listItemCount % 3 == 2%>
												<%if $i >= ($listItemCount - 2)%>
													<%assign var="XL" value="XL4 XL-half XL-lower"%>
												<%elseif $i >= ($listItemCount - 4)%>
													<%assign var="XL" value="XL4 XL-half"%>
												<%else%>
													<%assign var="XL" value="XL4"%>
												<%/if%>
												<%if $i < ($listItemCount - 4) && $i%3===0%>
													<%assign var="itemTopClass" value="XLT"%>
												<%elseif $i === ($listItemCount - 2)%>
													<%assign var="itemTopClass" value="XLT-clear-right"%>
												<%/if%>
											<%/if%>
											<%*<!--Has Side: XL Styles End-->*%>

											<%*<!--Has Side: L Styles-->*%>
											<%if $listItemCount === 1%>
												<%assign var="L" value="L12"%>
											<%elseif $listItemCount === 2%>
												<%assign var="L" value="L6 L-double-width"%>
											<%elseif $listItemCount % 2 === 0 && $l === 0%>
												<%if $i == 0 %>
													<%assign var="L" value="L12"%>
												<%elseif $i == 1 %>
													<%assign var="L" value="L12 L-half"%>
												<%else%>
													<%assign var="L" value="L6 L-half"%>
												<%/if%>
												<%if $i % 2 === 0 || $i<=1%>
													<%assign var="itemTopClass" value="`$itemTopClass` LT"%>
												<%/if%>
											<%elseif $listItemCount % 2 === 1 && $l === 0%>
												<%if $i === 0 %>
													<%assign var="L" value="L12"%>
												<%else%>
													<%assign var="L" value="L6 L-half"%>
												<%/if%>
												<%if $i % 2 === 1 || $i===0%>
													<%assign var="itemTopClass" value="`$itemTopClass` LT"%>
												<%/if%>
											<%elseif $listItemCount % 2 === 0%>
												<%assign var="L" value="L6 L-half"%>
												<%if $i % 2 === 0%>
													<%assign var="itemTopClass" value="`$itemTopClass` LT"%>
												<%/if%>
											<%elseif $listItemCount % 2 === 1%>
												<%if $i === 0 %>
													<%assign var="L" value="L12"%>
												<%else%>
													<%assign var="L" value="L6 L-half"%>
												<%/if%>
												<%if $i % 2 === 1 || $i === 0%>
													<%assign var="itemTopClass" value="`$itemTopClass` LT"%>
												<%/if%>
											<%/if%>
											<%*<!--Has Side: L Styles End-->*%>

											<%*<!--Has Side: M and P Use Single Column-->*%>
											<%if $l===0 && $i===0%>
												<%assign var="M" value="M12"%>
												<%assign var="P" value="P12"%>
											<%else%>
												<%assign var="M" value="M12 M-half"%>
												<%assign var="P" value="P12 P-half"%>
												<%assign var="itemTopClass" value="`$itemTopClass` MT PT"%>
											<%/if%>
											<%*<!--Has Side: M Styles End-->*%>

											<%*<!--Has Side: S Styles-->*%>
											<%if $listItemCount % 2 == 1 && $i===0 && $itemType == "video"%>
												<%assign var="S" value="S12"%>
											<%elseif $listItemCount % 2 == 1 && $i===0%>
												<%assign var="S" value="S12 S-double-width"%>
											<%else%>
												<%assign var="S" value="S6"%>
												<%if ($i%2===0 && $listItemCount % 2 == 0) || ($i%2===1 && $listItemCount % 2 == 1)%>
													<%assign var="itemTopClass" value="`$itemTopClass` ST"%>
												<%/if%>
											<%/if%>
											<%*<!--Has Side: S Styles End-->*%>

										<%/if%>


									<%else%>
										<%*<!--No Side Start-->*%>
										<%if $list.float === "SideBySide"%>
											<%if $i > 0%>
												<%assign var="XL" value="side-by-side"%>
												<%assign var="hideImage" value="yes"%>
												<%assign var="hideLead" value="yes"%>
											<%else%>
												<%assign var="XL" value="side-by-side first"%>
											<%/if%>
										<%elseif $list.float === "SplitList"%>
											<%assign var="XL" value="item-split-list"%>
											<%assign var="hideImage" value="no"%>
											<%if $i>0%>
												<%if $i%2===0%>
													<%assign var="itemTopClass" value="`$itemTopClass` XLT LT"%>
												<%/if%>
												<%assign var="itemTopClass" value="`$itemTopClass` MT ST PT"%>
											<%/if%>
										<%else%>
											<%*<!--No Side: XL Styles-->*%>
											<%if $listItemCount === 1%>

											<%elseif $listItemCount === 3%>

											<%elseif $listItemCount % 4 == 0%>
												<%assign var="XL" value="XL3"%>
												<%if $i % 4 === 0%>
													<%assign var="itemTopClass" value="XLT"%>
												<%/if%>
											<%elseif $listItemCount % 4 == 1%>
												<%if $i === ($listItemCount - 1) %>
													<%assign var="XL" value="XL3 XL-half XL-lower"%>
												<%elseif $i === ($listItemCount - 2) %>
													<%assign var="XL" value="XL3 XL-half"%>
												<%else%>
													<%assign var="XL" value="XL3"%>
												<%/if%>
												<%if $i !== ($listItemCount - 1) && $i%4===0%>
													<%assign var="itemTopClass" value="XLT"%>
												<%/if%>
											<%elseif $listItemCount % 4 == 2%>
												<%if $i===0 || $i===1%>
													<%assign var="XL" value="XL6"%>
												<%else%>
													<%assign var="XL" value="XL3"%>
												<%/if%>
												<%if $i===2 || ($i>4 && $i%4===2)%>
													<%assign var="itemTopClass" value="XLT"%>
												<%/if%>
											<%elseif $listItemCount % 4 == 3%>
												<%if $i===0 || $i===1%>
													<%assign var="XL" value="XL6"%>
												<%elseif $i === ($listItemCount - 1) %>
													<%assign var="XL" value="XL3 XL-half XL-lower"%>
												<%elseif $i === ($listItemCount - 2) %>
													<%assign var="XL" value="XL3 XL-half"%>
												<%else%>
													<%assign var="XL" value="XL3"%>
												<%/if%>
												<%if $i===2 || ($i>4 && $i%4===2 && $i<$listItemCount-2)%>
													<%assign var="itemTopClass" value="XLT"%>
												<%/if%>
											<%/if%>
											<%*<!--No Side: XL Styles End-->*%>

											<%*<!--No Side: L and M Styles-->*%>
											<%if $listItemCount === 1%>

											<%elseif $listItemCount === 3%>

											<%elseif $listItemCount === 4%>
												<%assign var="L" value="L3"%>
												<%assign var="M" value="M3"%>
											<%elseif $listItemCount % 3 == 0%>
												<%assign var="L" value="L4"%>
												<%assign var="M" value="M4"%>
												<%if $i % 3 === 0%>
													<%assign var="itemTopClass" value="`$itemTopClass` LT MT"%>
												<%/if%>
											<%elseif $listItemCount % 3 == 1%>
												<%if $i === ($listItemCount - 1) %>
													<%assign var="L" value="L4 L-half L-lower"%>
													<%assign var="M" value="M4 M-half M-lower"%>
												<%elseif $i === ($listItemCount - 2) %>
													<%assign var="L" value="L4 L-half"%>
													<%assign var="M" value="M4 M-half"%>
												<%else%>
													<%assign var="L" value="L4"%>
													<%assign var="M" value="M4"%>
												<%/if%>
												<%if $i !== ($listItemCount - 1) && $i%3===0%>
													<%assign var="itemTopClass" value="`$itemTopClass` LT MT"%>
												<%/if%>
											<%elseif $listItemCount % 3 == 2%>
												<%if $i>=($listItemCount - 2)%>
													<%assign var="L" value="L6 L-double-width"%>
													<%assign var="M" value="M6 M-double-width"%>
												<%else%>
													<%assign var="L" value="L4"%>
													<%assign var="M" value="M4"%>
												<%/if%>
												<%if $i%3===0%>
													<%assign var="itemTopClass" value="`$itemTopClass` LT MT"%>
												<%/if%>
											<%/if%>
											<%*<!--No Side: L and M Styles End-->*%>

											<%*<!--No Side: S Styles-->*%>
											<%if $listItemCount === 4%>
												<%assign var="S" value="S6"%>
												<%if $i===2 %>
													<%assign var="itemTopClass" value="`$itemTopClass` ST"%>
												<%/if%>
											<%elseif $listItemCount % 2 == 1 && $i===0%>
												<%assign var="S" value="S12 S-double-width"%>
											<%else%>
												<%assign var="S" value="S6"%>
												<%if ($i%2===0 && $listItemCount % 2 == 0) || ($i%2===1 && $listItemCount % 2 == 1)%>
													<%assign var="itemTopClass" value="`$itemTopClass` ST"%>
												<%/if%>
											<%/if%>
											<%*<!--No Side: S Styles End-->*%>

											<%*<!--No Side: P Use Single Column-->*%>
											<%if $listItemCount === 4%>
												<%assign var="P" value="P12"%>
												<%if $i===2 %>
													<%assign var="itemTopClass" value="`$itemTopClass` PT"%>
												<%/if%>
											<%elseif $l===0 && $i===0%>
												<%assign var="P" value="P12"%>
											<%else%>
												<%assign var="P" value="P12 P-half"%>
												<%assign var="itemTopClass" value="`$itemTopClass` PT"%>
											<%/if%>
											<%*<!--No Side: P Use Single Column End-->*%>
										<%/if%>
										<%*<!--No Side End-->*%>
									<%/if%>

									<%assign var="itemClass" value="`$XL` `$L` `$M` `$S` `$P`"%>
									<%if $itemTopClass != ""%>
									<%assign var="itemTop" value="<div class=\"`$itemTopClass`\"></div>"%>
									<%/if%>
									<%if $i === 0%>
										<%assign var="itemTop" value=""%>
									<%/if%>
									<%if $itemImage == "" && $itemType != "video" && $itemType != "third-party-iframe"%>
										<%assign var="hasImage" value="no-image"%>
									<%/if%>


									<%if $feedType=="columns"%>
										<%assign var="itemHeadline" value=$itemHeadline|replace:"《":""|replace:"》":""%>
									<%/if%>

									<%assign var="itemTimeStamp" value=""%>
									<%assign var="itemT" value=""%>
									<%*<!--MARK: - The data structure is so inconsistent that we have to handle it here. -->*%>
									<%if $itemType == "interactive"%>
										<%*<!--MARK: timeStamp if the interactive is dragged into list mannually, otherwise fileupdatetime from the API. If the feedType is all, you won't get the value because Video doesn't support this. -->*%>
										<%assign var="itemT" value=$item.timeStamp|default:$item.fileupdatetime|default:$item.last_publish_time|default:$item.pubdate%>
									<%elseif $list.float == "BiligualFullText"%>
										<%assign var="itemT" value=$item.eskylineheadline|default:$item.fileupdatetime%>
									<%else%>
										<%assign var="itemT" value=$item.timeStamp|default:$item.last_publish_time|default:$item.pubdate|default:$item.add_times%>
									<%/if%>
									<%assign var="itemT" value=$itemT|regex_replace:"/\.[0-9]+$/i":""%>
									<%assign var="highlightTime" value=""%>
									<%math assign="timeDiff" equation="x-y" x=$smarty.now y=$itemT%>
									<%assign var="timeMath" value=$timeDiff%>


									<%if $list.showTimeStamp == "all" || $list.showTimeStamp == "new stories" || $list.feedType == "myFT" || $list.float == "BiligualFullText"%>

										<%if $item.type === "video" && preg_match("/[0-9]+\-[0-9]+\-[0-9]+/is",$itemT)%>
											<%assign var="highlightTime" value=""%>
											<%assign var="timeDiff" value=$itemT|date_format:"%Y年%-m月%-d日"%>
											<%assign var="timeMath" value=0%>
											
										<%elseif $timeDiff < 0%>
											<%assign var="highlightTime" value=" highlight"%>
											<%assign var="timeDiff" value="刚刚发布"%>
										<%elseif $timeDiff < 60*60%>
											<%assign var="highlightTime" value=" highlight"%>
											<%assign var="timeDiff" value=$timeDiff/60|intval%>
											<%assign var="timeDiff" value="`$timeDiff`分钟前"%>
										<%elseif $timeDiff < 60*60*6%>
											<%assign var="highlightTime" value=" highlight"%>
											<%assign var="timeDiff" value=$timeDiff/3600|intval%>
											<%assign var="timeDiff" value="`$timeDiff`小时前"%>
										<%elseif $timeDiff < 60*60*24%>
											<%assign var="highlightTime" value=""%>
											<%assign var="timeDiff" value=$timeDiff/3600|intval%>
											<%assign var="timeDiff" value="`$timeDiff`小时前"%>
										<%elseif $timeDiff < 60*60*24*7%>
											<%assign var="highlightTime" value=""%>
											<%assign var="timeDiff" value=$timeDiff/86400|intval%>
											<%assign var="timeDiff" value="`$timeDiff`天前"%>
										<%elseif date("Y",$smarty.now) == date("Y",$item.timeStamp)%>
											<%assign var="highlightTime" value=""%>
											<%assign var="timeDiff" value=$itemT|date_format:"%-m月%-d日"%>
										<%else%>
											<%assign var="highlightTime" value=""%>
											<%assign var="timeDiff" value=$itemT|date_format:"%Y年%-m月%-d日"%>
										<%/if%>
										<%if $list.showTimeStamp === "all" || ($timeMath < 60*60*6 && $timeMath > 0)%>
											<%assign var="itemTimeStamp" value="<div class=\"item-time`$highlightTime`\" data-time=\"`$itemT`\" data-pubdate=\"`$item.pubdate`\" data-fileupdatetime=\"`$item.fileupdatetime`\" data-last-publish-time=\"`$item.last_publish_time`\">`$timeDiff`</div>"%>
										<%/if%>
									<%/if%>

									<%if $list.preferLead === "none"%>
										<%assign var="hideLead" value="yes"%>
										<%assign var="itemLead" value=""%>
									<%elseif $list.preferLead === "shortlead"%>
										<%assign var="itemLead" value=$item.shortlead|default:$item.cshortleadbody|default:$item.clead|default:$item.description%>
										<%assign var="itemLead" value=$itemLead|regex_replace:"/\-\|\-.*$/":""%>
										<%if $itemLead == "" || preg_match("/http|mp3|\|/is",$itemLead)%>
											<%assign var="itemLead" value=$item.clongleadbody|default:$item.clead|default:$item.longlead|default:$item.description%>
										<%/if%>
										<%assign var="itemLead" value=$itemLead|regex_replace:"/[\n\r]+$/":""%>
									<%else%>
										<%assign var="itemLead" value=$item.clongleadbody|default:$item.clead|default:$item.longlead|default:$item.description%>
										<%assign var="itemLead" value=$itemLead|regex_replace:"/\-\|\-.*$/":""%>
										<%if $itemLead == "" || preg_match("/http|mp3|\|/is",$itemLead)%>
											<%assign var="itemLead" value=$item.shortlead|default:$item.cshortleadbody|default:$item.clead|default:$item.description%>
										<%/if%>
										<%assign var="itemLead" value=$itemLead|regex_replace:"/[\n\r]+$/":""%>
									<%/if%>

									<%if $hideImage === "yes"%>
										<%assign var="hasImage" value="no-image"%>
									<%/if%>
									<%assign var="listLanguage" value=$list.language%>
									<%assign var="eheadline" value=""%>
									<%if $listLanguage != ""%>
										<%assign var="listLanguage" value="/`$listLanguage`"%>
										<%assign var="eheadline" value=$item.eheadline%>
									<%/if%>
									<%if $listLanguage == "/ce" && $eheadline != ""%>
										<%assign var="itemLead" value=$itemHeadline%>
										<%assign var="itemHeadline" value=$eheadline%>							
									<%elseif $listLanguage == "/en" && $eheadline != ""%>
										<%assign var="itemHeadline" value=$eheadline%>
									<%/if%>
									<%if $feedType=="columns"%>
										<%assign var="itemType" value="column"%>
									<%/if%>


									<%if ($memberType != "premium" && $smarty.server.REQUEST_URI|strstr:"EditorChoice-") || ($pageId == "speedread" && !$memberType)%>
										<%assign var="itemLink" value=" data-hint=\"dataHint\" "%>
									<%else%>
										<%if $item.customLink != "" %>
											<%assign var="itemLink" value=$item.customLink%>
											<%assign var="itemLink" value=" href=\"`$itemLink`\""%>
										<%elseif $itemId == "" || $itemType == "" %>
											<%assign var="itemLink" value=""%>
										<%else%>
											<%assign var="itemLink" value="/`$itemType`/`$itemId``$listLanguage``$adForceString`"%>
											<%assign var="itemLink" value=" href=\"`$itemLink`\""%>
										<%/if%>
										
									<%/if%>
									
				

									<%if $listType === "videos" && $i==0%>
										<div class="item-inner video-package-inner"><div class="image"><figure id="video-package-play" class="loading-video" data-vid="<%$itemId%>"></figure></div><div class="video-package-title"><a href="/video/<%$itemId%>" target=_blank><%$itemHeadline%></a></div></div>
									<%/if%>

									<%if $item.preferSponsorImage == "yes" && $itemTagLink != "" && $tagImage != ""%>
										<%assign var="itemImageLink" value=" href=\"`$itemTagLink`\" data-sponsor-link=\"yes\""%>
									<%else%>
										<%assign var="itemImageLink" value=$itemLink%>
									<%/if%>


									<%assign var="itemSubType" value=""%>
									<%if $itemType == "interactive"%>
										<%if preg_match("/速读/is",$itemTagsString) %>
											<%assign var="itemSubType" value="speedreading"%>
										<%elseif preg_match("/电台|音频/is",$itemTagsString) %>
											<%assign var="itemSubType" value="radio"%>
										<%elseif preg_match("/双语阅读/is",$itemTagsString) %>
											<%assign var="itemSubType" value="bilingual"%>
										<%elseif preg_match("/数据新闻/is",$itemTagsString) %>
											<%assign var="itemSubType" value="datanews"%>
										<%elseif preg_match("/深度阅读/is",$itemTagsString) %>
											<%assign var="itemSubType" value="htmlbook"%>
										<%elseif preg_match("/MBA训练营|教程/is",$itemTagsString) %>
											<%assign var="itemSubType" value="mbagym"%>
										<%/if%>
									<%/if%>

									<%if $itemSubType == "radio"%>
										<%assign var="itemClass" value="`$itemClass` is-audio"%>
									<%/if%>

									<%assign var=isInWhiteList value="no"%>
									<%if $whitelist != ""%>
										<%foreach from=$itemTags item=tag%>
											<%if preg_match("/`$tag`/is",$whitelist)%>
												<%assign var=isInWhiteList value="yes"%>
											<%/if%>
										<%/foreach%>
									<%/if%>

									<%if $smarty.get.webview == "ftcapp"%>
										<%if preg_match("/双语电台/is",$itemTagsString)%>
											<%if preg_match("/en|ce/is",$listLanguage) && preg_match("/.mp3$/is",$item.eshortleadbody)%>
												<%assign var="audioUrl" value=$item.eshortleadbody%>
												<%assign var="itemSubType" value="bilingual_audio_english"%>
											<%elseif preg_match("/.mp3$/is",$item.cshortleadbody)%>
												<%assign var="audioUrl" value=$item.cshortleadbody%>
												<%assign var="itemSubType" value="bilingual_audio_chinese"%>
											<%/if%>
											<%*<!--MARK: - Pass the data-language parameter to native app -->*%>
											<%assign var="audioData" value=" data-audio=\"`$audioUrl`\""%>
										<%elseif preg_match("/.mp3$/is",$item.shortlead) || preg_match("/.mp3$/is",$item.cshortleadbody)%>
											<%assign var="audioUrl" value=$item.shortlead|default:$item.cshortleadbody%>
											<%assign var="audioData" value=" data-audio=\"`$audioUrl`\""%>
										<%else%>
											<%assign var="audioUrl" value=""%>
											<%assign var="audioData" value=""%>
											<%*<!--MARK: - Some the editor will mark the item as an audio, but it has no audio file. -->*%>
											<%if $itemSubType == "radio"%>
												<%assign var="itemSubType" value=""%>
											<%/if%>
										<%/if%>
										<%if preg_match("/.mp3$/is",$item.caudio)%>
											<%assign var="caudioUrl" value=$item.caudio%>
											<%assign var="caudioData" value=" data-caudio=\"`$caudioUrl`\""%>
										<%else%>
											<%assign var="caudioUrl" value=""%>
											<%assign var="caudioData" value=""%>
										<%/if%>

										<%if preg_match("/.mp3$/is",$item.eaudio)%>
											<%assign var="eaudioUrl" value=$item.eaudio%>
											<%assign var="eaudioData" value=" data-eaudio=\"`$eaudioUrl`\""%>
										<%elseif preg_match("/.mp3$/is",$item.eshortleadbody)%>
											<%assign var="eaudioUrl" value=$item.eshortleadbody%>
											<%assign var="eaudioData" value=" data-eaudio=\"`$eaudioUrl`\""%>
										<%else%>
											<%assign var="eaudioUrl" value=""%>
											<%assign var="eaudioData" value=""%>
										<%/if%>

										<%if $itemSubType != ""%>
											<%assign var="subTypeData" value=" data-sub-type=\"`$itemSubType`\""%>
										<%else%>
											<%assign var="subTypeData" value=""%>
										<%/if%>
										<%*<!--MARK: Only story needs to show date here-->*%>
										<%if $inSponsor != "yes" && $itemT != "" && $itemType == "story" && $isInWhiteList == "no"%>
											<%assign var="dateData" value=" data-date=\"`$itemT`\""%>
										<%else%>
											<%assign var="dateData" value=""%>
										<%/if%>
										<%assign var="itemDataId" value=$item.id|default:$item.customLink%>
										<%if $itemDataId == "" && $item.customLink != ""%>
											<%assign var="itemDataId" value=$item.customLink%>
										<%/if%>
										<%assign var="itemDataType" value=$itemType%>
										<%if $smarty.get.try == "yes" && ($i>2 || ($l>0 && $i>0))%>
											<%assign var="itemDataType" value="TryBook"%>
											<%assign var="lockClass" value="locked"%>
										<%/if%>

										<%assign var="itemData" value=" data-id=\"`$itemDataId`\" data-type=\"`$itemDataType`\"`$audioData``$caudioData``$eaudioData``$subTypeData``$dateData` data-keywords=\"`$itemTagsString`\""%>

										<%*<!--MARK: - Some time the ad sales requested to extend the home page just to squeeze in more ads. There's nothing we can do about it. But to minimize the damage by not prefetch stories of the extended parts.  -->*%>
										<%assign var="isExtendedStoryOnHome" value="no"%>
										<%if $pageId == "home" && $b >= 1 && ($itemType == "story" || $itemType == "premium")%>
											<%assign var="isExtendedStoryOnHome" value="yes"%>
										<%/if%>
										<%*<!--page id: <%$pageId%>, b: <%$b%>, maxB: <%$maxB%>, isExtendedStoryOnHome: <%$isExtendedStoryOnHome%>, version: 7-->*%>
										<%if $itemDataId == "" || $itemDataType == "manual" || $isExtendedStoryOnHome == "yes"%>
											<%assign var="itemData" value=""%>
										<%/if%>

										<%if $itemDataId != "" && $itemDataType != "" && $itemDataType != "manual" && $useCorpToRenderStory != "yes" && $isExtendedStoryOnHome == "no"%>
											<%assign var="itemClass" value="`$itemClass` item-container-app"%>
										<%/if%>
										<%*<!-- MARK: Show full text for premium content for internal use only!  -->*%>
										<%if $smarty.get.showfulltext == "yes"%>
											<%assign var="itemLink" value=" href=\"/`$itemType`/`$itemId`?webview=ftcapp&screencapture=yes&ad=no\""%>
										<%/if%>

										



										<%*<!-- check user corp: <%$useCorpToRenderStory%>, item type: <%$itemType%>-->*%>
										<%if $useCorpToRenderStory == "yes" && ($itemType == "story" || $itemType == "premium")%>
											<%assign var="itemData" value=""%>
											<%assign var="itemLink" value=" href=\"/m/corp/preview.html?pageid=`$itemId`&webview=ftcapp\""%>
										<%/if%>

									<%/if%> 
									<%*<!--end  $smarty.get.webview == "ftcapp"-->*%>

									<%if $list.feedType == "myFTNew"%>
										<%assign var="itemAuthor" value=$item.cauthor%>
										<%assign var="itemData" value=" data-keywords=\"`$itemTagsString`\" data-author=\"`$itemAuthor`\""%>
									<%/if%>

									<%*<!--MARK: show the lock for paid content-->*%>
									<%if $list.feedType == "premium" || $item.type == "premium" || $itemType == "premium" || $paywall == "1" || ($itemType == "interactive" && preg_match("/英语电台|速读|会员专享|高端专享/is",$itemTagsString)) || ($itemType == "story" && $timeMath > 60*60*24)%>
										<%assign var="lockClass" value="locked"%>
										<%if preg_match("/高端专享/is",$itemTagsString)%>
											<%assign var="lockClass" value="locked vip"%>
										<%/if%>
									<%else%>
										<%assign var="lockClass" value=""%>
									<%/if%>

									<%if $inSponsor == "yes"%>
										<%assign var="lockClass" value=""%>
									<%else%>
									<%/if%>

									<%if $isInWhiteList == "yes" && lockClass != ""%>
										<%assign var="lockClass" value="unlocked whitelist"%>
									<%/if%>

									<%*<!--MARK: - Convenient for Editing -->*%>
									<%if $smarty.get.mode == "edit"%>
										<%assign var="itemLink" value=" href=\"https://backyard.ftchinese.com/falcon.php/story/edit/`$itemId`\""%>
									<%/if%>


									<%*<!--MARK: - Fix FTC Android App bug start-->*%>
									<%if $displayMBAGymWithCorp == "yes" && $itemSubType == "mbagym"%>
										<%assign var=itemLink value=" href=\"/m/corp/interactive.html?id=`$itemId`\""%>
										<%assign var=itemImageLink value=$itemLink%>
										<%assign var=itemData value=""%>
										<%assign var=itemClass value=$itemClass|replace:"item-container-app":""%>
									<%/if%>
									<%*<!--MARK: - Fix FTC Android App bug end-->*%>

									<%if $listType == "videos" && $i>5%>
										<%*<!--Only display first 6 in video package-->*%>
									<%elseif $list.float === "ScoreBoard"%>
										<tr id="inter<%$itemId%>">
											<td class="td1"><a target="_blank"<%$itemLink%> class="item-headline-link"><%$itemHeadline%></a></td>
											<td class="td3">&nbsp;</td>
											<td class="td6">&nbsp;</td>
											<td class="td4">&nbsp;</td>
											<td class="td5">&nbsp;</td>
										</tr>
										<%assign var="i" value=$i+1%>
									<%elseif $list.float === "myFT"%>
										<%$itemTop%>
										<div class="item-container <%$itemClass%> <%$hasImage%>"<%$itemData%>><div class="item-inner">
											<%$itemTag%>
											<div class="item-headline-lead">
											<h2 class="item-headline"><a target="_blank"<%$itemLink%> class="item-headline-link <%$lockClass%>"><%$itemHeadline%></a></h2>
											<%if $hideLead === "no"%><div class="item-lead"><%$itemLead|nl2br%></div><%/if%>
											</div>
											<%if $itemType == "story" || $itemType == "premium"%>
												<div class="icon-right icon-save">
													<button id="addfavlink<%$itemId%>">收藏</button>
												</div>
											<%/if%>
											<%$itemTimeStamp%>
											<div class="item-bottom"></div>
										</div></div>
										<%assign var="i" value=$i+1%>
									<%elseif $list.float === "Headshot"%>
										<%if $list.feedItems > 0 && $list.feedItems < $list.items|@count && $list.feedItems <= $i%>
											<%assign var="showMoreButton" value="yes"%>
											<%assign var="itemClass" value="`$itemClass` hide"%>
											<%if $itemTopClass != ""%>
												<%assign var="itemClass" value="`$itemClass` "%>
												<%assign var="itemTop" value="<div class=\"`$itemTopClass` hide\"></div>"%>
											<%/if%>
										<%/if%>
										<%$itemTop%>
										<div class="item-container <%$itemClass%> <%$hasImage%>"<%$itemData%>><div class="item-inner">
											<a class="image portrait-img" target="_blank"<%$itemLink%>><figure class="loading" data-url="<%$itemImage|replace:"/upload/":"/"%>"></figure></a>
											<%$itemTag%>
											<div class="item-headline-lead">
											<h2 class="item-headline"><a target="_blank"<%$itemLink%> class="item-headline-link <%$lockClass%>"><%$itemHeadline%></a></h2>
											<%if $hideLead === "no"%><div class="item-lead"><%$itemLead|nl2br%></div><%/if%>
											</div>
											<%$itemTimeStamp%>
											<div class="item-bottom"></div>
										</div></div>
										<%assign var="i" value=$i+1%>
									<%elseif $list.float === "HeadshotSquare"%>
										<%if $list.feedItems > 0 && $list.feedItems < $list.items|@count && $list.feedItems <= $i%>
											<%assign var="showMoreButton" value="yes"%>
											<%assign var="itemClass" value="`$itemClass` hide"%>
											<%if $itemTopClass != ""%>
												<%assign var="itemClass" value="`$itemClass` "%>
												<%assign var="itemTop" value="<div class=\"`$itemTopClass` hide\"></div>"%>
											<%/if%>
										<%/if%>
										<%$itemTop%>
										<div class="item-container <%$itemClass%> <%$hasImage%>"<%$itemData%>><div class="item-inner">
											<a class="image square-img" target="_blank"<%$itemLink%>><figure class="loading" data-url="<%$itemImage|replace:"/upload/":"/"%>"></figure></a>
											<%$itemTag%>
											<div class="item-headline-lead">
											<h2 class="item-headline"><a target="_blank"<%$itemLink%> class="item-headline-link <%$lockClass%>"><%$itemHeadline%></a></h2>
											<%if $hideLead === "no"%><div class="item-lead"><%$itemLead|nl2br%></div><%/if%>
											</div>
											<%$itemTimeStamp%>
											<div class="item-bottom"></div>
										</div></div>
										<%assign var="i" value=$i+1%>
									<%elseif $list.float === "eBook"%>
										<%$itemTop%>
										<div class="item-container <%$itemClass%> has-image ebook"<%$itemData%>><div class="item-inner">
											<a class="image portrait-img" target="_blank"<%$itemLink%>><figure class="loading" data-url="<%$itemImage|replace:"/upload/":"/"%>"></figure></a>
											<div class="item-bottom"></div>
										</div></div>
										<%assign var="i" value=$i+1%>
									<%elseif $list.float === "VideoWall"%>
										<%$itemTop%>
										<a href="/<%$itemType%>/<%$itemId%>" target="_blank">
										<div class="item-container <%$itemClass%> has-image video-wall"<%$itemData%>>
											<div class="item-inner video-package-inner" style="padding:0;"><div class="image" style="width: 100%;left: 0;right: 0;padding: 0;">
												<figure id="video-package-play" class="loading-video" data-vid="<%$itemId%>" data-type="<%$itemType%>" data-autoplay="yes"></figure>
											</div></div>
										</div>
										</a>
										<%assign var="i" value=$i+1%>
									<%elseif $itemType === "widget"%>
										<div class="item-container <%$itemClass%> no-image"><div class="item-inner">
											<%include file="widgets/`$itemHeadline`"%>
										</div></div>
										<%assign var="i" value=$i+1%>
									<%elseif $list.float === "BiligualFullText"%>
										<%assign var="cheadline" value=$item.cheadline%>
										<div class="item-container no-image bilingual-full-text translation-<%if preg_match("/translation_confirmed/is",$itemTagsString)%>confirmed<%else%>machine<%/if%>" data-id="<%$itemId%>" data-ft-id="<%$item.eshortleadbody%>"><div class="item-inner">
											<div class="time-container" data-original-time="<%$item.eskylineheadline%>"><%$itemTimeStamp%></div>
											<div class="translation-disclaimer"></div>
											<div class="title-container"><div class="original"><%$item.eheadline%></div><div class="translations"><%$item.cheadline%></div></div>
											<div class="byline-container"><div class="original"><%$item.eauthor%></div><div><%$item.cauthor%></div></div>
											<div class="body-container"><div class="original"><%$item.ebody%></div><div class="translations"><%$item.cbody|regex_replace:"/\-\|\-[\s\S]*$/i":""%></div></div>
										</div></div>
										<%assign var="i" value=$i+1%>
									<%else%>
										<%$itemTop%>

										<%*<!-- for viewtop video play -->*%>
										<%assign var="videoId" value="" %>
										<%assign var="videoIdIndex" value=0 %>
										<%if $listType === "videos" && preg_match("/高端视点/is",$itemTagsString) %>
											<%assign var="videoId" value="viewtopVideo" %>
											<%assign var="videoIdIndex" value=$videoIdIndex+1 %>
										<%/if%>
										<%*<!-- Real Item of Block -->*%>
										<div class="item-container <%$itemClass%> <%$hasImage%>"<%$itemData%> data-update="<%$itemT%>"><div class="item-inner">
											<h2 class="item-headline"><%$itemTag%><a target="_blank"<%$itemLink%> class="item-headline-link <%$lockClass%>"><%$itemHeadline%></a></h2>
											<%if $item.relatives|@count > 0 && $item.relatives[0].type == "video" &&  $item.preferSponsorImage != "yes"%>
												<div class="image">
													<figure class="loading-video" data-vid="<%$item.relatives[0].id%>"></figure>
												</div>
											<%elseif ($itemType === "video" && $listType !== "videos" && $item.preferSponsorImage != "yes") || ($itemType == "interactive" && preg_match("/推广视频|精彩视频|产品视频/is",$item.tag))%>
												<div class="image">
													<figure class="loading-video" data-vid="<%$itemId%>" data-item-type="<%$itemType%>"></figure>
												</div>
											<%elseif $itemType === "third-party-iframe"%>
												<%if $supportThirdPartyFrame == "yes"%>
													<div class="image">
														<figure class="loading-video" data-third-party-frame-url="<%$itemImage%>"></figure>
													</div>
												<%else%>
													<div class="image">
														<figure><iframe name="video-frame" id="video-frame" style="width:100%;height:100%;position:absolute;" src="<%$itemImage%>" scrolling="no" frameborder="0" allowfullscreen="true" data-target="legacy"></iframe></figure>
													</div>
												<%/if%>
											<%elseif $itemImage != "" && $hasImage === "has-image"%>
												<a class="image" target="_blank"<%$itemImageLink%> <%if $videoId === "viewtopVideo" && $videoIdIndex == 1 %>id="viewtopVideo"<%/if%>>
													<figure class="loading" data-url="<%$itemImage|replace:"/upload/":"/"%>"></figure>
												</a>
											<%/if%>
											<%if $hideLead === "no"%><div class="item-lead"><%$itemLead|nl2br%></div><%/if%>
											<%$itemTimeStamp%>
											<%if $item.relatives|@count > 0 && $item.showRelativeStoryItems > 0%>
												<%assign var="r" value=0%>
												<div class="relative-container">
													<%foreach from=$item.relatives item=relative%>
														<%if $r<$item.showRelativeStoryItems%>
														<h3 class="relative"><a href="/<%$relative.type%>/<%$relative.id%>" target="_blank"><%$relative.headline%></a></h3>
														<%assign var="r" value=$r+1%>
														<%/if%>
													<%/foreach%>
													<div class="clearfloat"></div>
												</div>
											<%/if%>
											<div class="item-bottom"></div>
										</div></div>
										<%assign var="i" value=$i+1%>
									<%/if%>

									<%if $smarty.get.ad != "no" && $hideAd != "yes" && $noAd != "true"%>
										<%*<!--insert an extra MPU for mobile phone start-->*%>
										<%if $b == 0 && $l == 0 && $list.float != "VideoWall" && $noAd != "true" && $list.float != "SplitList"%>
											<%if $pageId == "home"%>
												<%assign var="mpuName" value="homempu"%>
											<%else%>
												<%assign var="mpuName" value="taginlinempu"%>
											<%/if%>
											<%if $i == 3 && $smarty.get.webview == "ftcapp"%>
												<div id="iap-highlight"></div>
											<%/if%>
											<%if $i == 1%>
												<div 
												data-o-ads-name="infoflow1"
												class="o-ads infoflow"  
												data-o-ads-formats-default="false" 
												data-o-ads-formats-small="FtcInfoFlow" 
												data-o-ads-formats-medium="false"
												data-o-ads-formats-large="false"
												data-o-ads-formats-extra="false"
												data-o-ads-targeting="cnpos=info1;"
												>
												</div>
											<%/if%>
											<%if $i == 8%>
												<div 
												data-o-ads-name="mpu-middle1"
												class="o-ads"  
												data-o-ads-formats-default="false" 
												data-o-ads-formats-small="FtcMobileMpu" 
												data-o-ads-formats-medium="false"
												data-o-ads-formats-large="false"
												data-o-ads-formats-extra="false"
												data-o-ads-targeting="cnpos=middle1;"
												data-cy='[{"devices":["iPhoneWeb","AndroidWeb","iPhoneApp"],"pattern":"MPU","position":"Middle1"}]'
												>
												</div>
											<%/if%>
											<%if $i == 13%>
												<div 
												data-o-ads-name="infoflow2"
												class="o-ads infoflow"  
												data-o-ads-formats-default="false" 
												data-o-ads-formats-small="FtcInfoFlow" 
												data-o-ads-formats-medium="false"
												data-o-ads-formats-large="false"
												data-o-ads-formats-extra="false"
												data-o-ads-targeting="cnpos=info2;"
												>
												</div>
											<%/if%>
											<%if $i == 18%>
												<div 
												data-o-ads-name="mpu-middle2"
												class="o-ads" 
												data-o-ads-formats-default="false" 
												data-o-ads-formats-small="FtcMobileMpu" 
												data-o-ads-formats-medium="false"
												data-o-ads-formats-large="false"
												data-o-ads-formats-extra="false"
												data-o-ads-targeting="cnpos=middle2;"
												data-cy='[{"devices":["iPhoneWeb","AndroidWeb","iPhoneApp","AndroidApp"],"pattern":"MPU","position":"Middle2"}]'
												>
												</div>
											<%/if%>
										<%/if%>
										<%if $l == 0 && $list.float != "VideoWall" && $noAd != "true" && $list.float != "SplitList"%>
											<%if ($b == 1 && $i == 4) || ($blockCount <= 1 && $b == 0 && $i == 18)%>
												<div 
												data-o-ads-name="infoflow3"
												class="o-ads infoflow"  
												data-o-ads-formats-default="false" 
												data-o-ads-formats-small="FtcInfoFlow" 
												data-o-ads-formats-medium="false"
												data-o-ads-formats-large="false"
												data-o-ads-formats-extra="false"
												data-o-ads-targeting="cnpos=info3;"
												>
												</div>
											<%/if%>
											<%if ($b == 1 && $i == 8) || ($blockCount <= 1 && $b == 0 && $i == 21) %>
												<div 
												data-o-ads-name="mpu-middle3"
												class="o-ads" 
												data-o-ads-formats-default="false" 
												data-o-ads-formats-small="FtcMobileMpu" 
												data-o-ads-formats-medium="false"
												data-o-ads-formats-large="false"
												data-o-ads-formats-extra="false"
												data-o-ads-targeting="cnpos=middle3;"
												data-cy='[{"devices":["iPhoneWeb","AndroidWeb","iPhoneApp","AndroidApp"],"pattern":"MPU","position":"Middle3"}]'
												>
												</div>
											<%/if%>
											<%if ($b == 3 && $i == 4) || ($blockCount <= 3 && $b == 0 && $i == 25)%>
												<div 
												data-o-ads-name="infoflow4"
												class="o-ads infoflow"  
												data-o-ads-formats-default="false" 
												data-o-ads-formats-small="FtcInfoFlow" 
												data-o-ads-formats-medium="false"
												data-o-ads-formats-large="false"
												data-o-ads-formats-extra="false"
												data-o-ads-targeting="cnpos=info4;"
												>
												</div>
											<%/if%>
											<%if ($b == 3 && $i == 9) || ($blockCount <= 3 && $b == 0 && $i == 30)%>
												<div 
												data-o-ads-name="mpu-middle4"
												class="o-ads" 
												data-o-ads-formats-default="false" 
												data-o-ads-formats-small="FtcMobileMpu" 
												data-o-ads-formats-medium="false"
												data-o-ads-formats-large="false"
												data-o-ads-formats-extra="false"
												data-o-ads-targeting="cnpos=middle4;"
												data-cy='[{"devices":["iPhoneWeb","AndroidWeb","iPhoneApp","AndroidApp"],"pattern":"MPU","position":"Middle4"}]'
												>
												</div>
											<%/if%>
										<%/if%>
										<%*<!--insert an extra MPU for mobile phone end-->*%>
									<%/if%>
								<%/if%> <%*<!--end <%if $feedRepeatCheck != "yes" -->*%>
							<%/foreach%>  <%*<!--end foreach itemsArray -->*%>
						<%/if%>
						<%if $list.float === "ScoreBoard"%>
							</tbody>
							</table>
							</div>
							<script src="https://dhgxl8qk9zgzr.cloudfront.net/js/jquery-1.10.2.min.js" type="text/javascript"></script>
							<script src="https://dhgxl8qk9zgzr.cloudfront.net/js/table.js?2" type="text/javascript"></script>
							<script src="https://dhgxl8qk9zgzr.cloudfront.net/js/jquery.tablesorter.min.js" type="text/javascript"></script>
							<script language=javascript>
							setTimeout(function(){$("#box-table-a").tablesorter();$("#box-table-a thead tr th").attr("class","header");},10000);
							</script>
						<%/if%>
						<div class="clearfloat"></div>
					</div>
					<%if $list.sponsorNote != ""%>
						<div class="item-container no-image"><div class="item-inner"><%$list.sponsorNote|regex_replace:"/([A-Z0-9a-z._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,6})/i":"<a class=\"blue-link\" href=\"mailto: \\1\">\\1</a>"%></div></div>
					<%/if%>
					<%if $list.moreLink != ""%>
						<div class="more-link"><a href="<%$list.moreLink%>">更多</a></div>
					<%elseif $showMoreButton == "yes"%>
						<script>
							function showMore(ele) {
								var hidenDivs = ele.parentNode.parentNode.querySelectorAll('.hide');
								for (var i=0; i<hidenDivs.length; i++) {
									hidenDivs[i].className = hidenDivs[i].className.replace(' hide', '');
								}
								ele.parentNode.style.display = 'none';
								try {
									loadImages();
									stickyBottomPrepare();
								} catch (ignore) {

								}
							}
						</script>
						<div class="more-link"><a onclick="showMore(this)">更多</a></div>
						<%assign var="showMoreButton" value=""%>
					<%/if%>
					<%assign var="next" value=$l+1%>
					<%*<!--combine side lists-->*%>
					<%if $listHasFloat === "none" || $listHasFloat === "SideBySide" || $listHasFloat === "SplitList" || $l === $section.lists|@count-1 || ($next < $section.lists|@count && $list.float != $section.lists[$next].float)%></div></div><%/if%>
					<%assign var="l" value=$l+1%>
				<%/if%> <%* <!--end $list.feedType -->*%>
				<%if ($list.name == "[iframe]" || $list.name == "[video]") && $list.url != ""%>
					<div class="list-container<%$listClass%>">
						<div class="list-inner">
							<iframe style="<%$list.style|default:'width: 100%; height: 400px'%>" frameborder="0" scrolling="no" marginwidth="0" marginheight="0" src="<%$list.url|default:"#"%>" data-src="<%$list.url|default:"#"%>" data-ad-type="mpu" data-ad-count="0"></iframe>
						</div>
					</div>
				<%/if%>
			<%/if%>
		<%/foreach%>   <%* <!--end foreach $section.lists-->*%>
		<div class="clearfloat block-bottom"></div>
	</div>  <%* <!--end class="content-inner" -->*%>
</div>  <%* <!--end class="content-container"-->*%>

	<%assign var="sideMpuCount" value=0%>
	<%if $sideListCount > 0%>
		<div class="side-container"><div class="side-inner">
			<%assign var="s" value=0%>	
			<%foreach from=$section.lists item=list%>
				<%assign var="firstChildClass" value=""%>
				<%assign var="lastChildClass" value=""%>
				<%if $s == 0%>
					<%assign var="firstChildClass" value=" first-child"%>
				<%/if%>
				<%if $s == $sideListCount - 1 %>
					<%assign var="lastChildClass" value=" last-child"%>
				<%/if%>
				<%if $list.type == "SideMPU"%>
					<%if $pageId == "home"%>
						<%assign var="mpuPosition" value="mpu"%>
					<%else%>
						<%assign var="mpuPosition" value="tagmpu"%>
					<%/if%>
					<%if $smarty.get.ad != "no" && $noAd != "true"%>
						
						<%if $list.image != ""%>
							<%if $list.url && $list.url != ""%>
								<%assign var="listLink" value=" href=\"`$list.url`\" target=_blank"%>
							<%else%>
								<%assign var="listLink" value=""%>
							<%/if%>
							<div class="mpu-container<%$firstChildClass%><%$lastChildClass%>">
								<a<%$listLink%>><figure class="loading" data-url="<%$list.image%>"></figure></a>
							</div>
						<%else%>
							<%if $sideMpuCount == 0 %>
								<div 
								data-o-ads-name="mpu-right1"
								class="o-ads"  
								data-o-ads-formats-default="false" 
								data-o-ads-formats-small="false" 
								data-o-ads-formats-medium="FtcMpu"
								data-o-ads-formats-large="FtcMpu"
								data-o-ads-targeting="cnpos=right1;"
								data-cy='[{"devices":["PC","PadApp","PadWeb"],"pattern":"MPU","position":"Right1"}]'
								>
								</div>
							<%elseif $sideMpuCount == 1%>
								<div 
								data-o-ads-name="mpu-right2"
								class="o-ads ftc-mpu"  
								data-o-ads-formats-default="false" 
								data-o-ads-formats-small="false" 
								data-o-ads-formats-medium="FtcMpu"
								data-o-ads-formats-large="FtcMpu"
								data-o-ads-targeting="cnpos=right2;"
								data-cy='[{"devices":["PC","PadApp","PadWeb"],"pattern":"MPU","position":"Right2"}]'
								>
								</div>
							<%/if%>
						<%/if%>
						<%assign var="s" value=$s+1%>
						<%assign var="sideMpuCount" value=$sideMpuCount+1%>
					<%/if%>
                <%elseif $list.type == "SideIframe"%>
						<div class="mps<%$firstChildClass%><%$lastChildClass%>">
							<iframe width="<%$list.width|default:300%>" height="<%$list.height|default:250%>" frameborder="0" scrolling="no" marginwidth="0" marginheight="0" src="<%$list.url|default:"#"%>" data-src="<%$list.url|default:"#"%>" data-ad-type="mpu" data-ad-count="0"></iframe>
						</div>
				<%elseif $list.type == "SideInclude"%>
						<div class="mps<%$firstChildClass%><%$lastChildClass%>">
							<h2 class="list-title"><a href="<%$list.url|default:"#"%>"><%$list.title|default:$defaultTitle%></a></h2>
							<%include file="next/partials/`$list.fromSide`.html"%>
						</div>
						<%assign var="s" value=$s+1%>
				<%elseif $list.type == "SideInfo"%>
						<%if $list.InfoType == "author"%>
							<%assign var=sideInfoTitle value="关于`$list.title`"%>
						<%else%>
							<%assign var=sideInfoTitle value=$list.title%>
						<%/if%>
						<%if $list.link != ""%>
							<%assign var=sideInfoLink value=" href=\"`$list.link`\""%>
						<%elseif $list.InfoType == "author"%>
							<%assign var=sideInfoLink value=" href=\"/author/`$list.title`\""%>
						<%else%>
							<%assign var=sideInfoLink value=""%>
						<%/if%>
						<div class="side-list<%$firstChildClass%><%$lastChildClass%>">
							<div class="list-title">
								<a<%$sideInfoLink%>><%$sideInfoTitle%></a>
							</div>
							<div class="item-lead item-description">
								<%if $list.HeadImage != ""%>
									<a class="image square-icon" target="_blank"><figure class="loading" data-url="<%$list.HeadImage%>"></figure></a>
								<%/if%>
								<%$list.Detail%>
							</div>
						</div>
						<%assign var="s" value=$s+1%>
				<%elseif $list.type == "SideRanking"%>
					<%if $list.RankingBy == ""%>
						<%if $list.feedType == "video"%>
							<%assign var="defaultTitle" value="热门视频"%>
							<%assign var="feedType" value="video"%>
							<%assign var="mp" value=$videomodel->get_hot_video(30,10) %>
						<%else%>
							<%assign var="defaultTitle" value="热门文章"%>
							<%assign var="feedType" value="story"%>
							<%*easyapi command="60006"*%>
							<%*assign var="mp" value=$data.odatalist*%>
							<%assign var="mp" value=$storymodel->get_hot_story(1,10) %>
						<%/if%>
						<%if $list.feedItems == 0%>
							<%assign var="feedItems" value=10%>
						<%else%>
							<%assign var="feedItems" value=$list.feedItems%>
						<%/if%>
						<div class="mps<%$firstChildClass%><%$lastChildClass%>">
							<h2 class="list-title"><a href="<%$list.url|default:"#"%>"><%$list.title|default:$defaultTitle%></a></h2>
							<ul class="top10">
								<%assign var="i" value=0%>							
								<%foreach item=sc from=$mp%>
									<%if $i<$feedItems%>
										<%assign var="i" value=$i+1%>
										<li class="mp<%$i%>"><span><%$i%>. </span><a target="_blank" href="/<%$feedType%>/<%$sc.storyid|default:$sc.id%>"><%$sc.cheadline|default:$sc.title%></a></li>
									<%/if%>
								<%/foreach%>
							</ul>
						</div>
					<%else%>
						<%include file="next/partials/`$list.RankingBy`.html"%>
					<%/if%>
					<%assign var="s" value=$s+1%>
					<%*<!--end SideRanking -->*%>
				<%elseif $list.type == "SideWithItems"%>
					<%assign var="itemTag" value=""%>
					<div class="side-list<%$firstChildClass%><%$lastChildClass%> <%$list.sideOption%>">
						<%if $list.title && $list.title != ""%>
							<h2 class="list-title">
								<%if $list.url != ""%>
									<a href="<%$list.url%>"><%$list.title%></a>
								<%else%>
									<a href="#"><%$list.title%></a>
								<%/if%>
							</h2>
						<%/if%>
						<%if $list.items|@count==0 && $list.feedItems != "" && $list.feedItems != "0"%>
							<%if preg_match("/like|find_in_set|=|\(| in /is",$list.feedTag)%>
								<%if $list.feedType == "story"%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="itemsArray" value=$storymodel->get_story_by_field_search($list.feedTag,0,$list.feedItems,600,10800)%>
								<%elseif $list.feedType == "interactive"%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="itemsArray" value=$interactivemodel->get_interactive_by_field_search($list.feedTag,0,$list.feedItems,600,10800)%>
								<%elseif $list.feedType == "video"%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="itemsArray" value=$videomodel->get_video_by_field_search($list.feedTag,0,$list.feedItems,600,10800)%>
								<%elseif $list.feedType == "photo"%>
									<%assign var="feedType" value="photonews"%>
									<%assign var="itemsArray" value=$photonewsmodel->get_photonews_by_field_search($list.feedTag,"ORDER BY photonewsid DESC",$list.feedItems)%>
								<%elseif $list.feedType == "premium"%>
									<%*<!--Premium Content Should Display -->*%>
									<%assign var="feedType" value=$list.feedType%>
									<!--<%*assign var="itemsArray" value=$storymodel->getContentByTag("FT独家",$feedItems)*%>-->
									<%assign var="itemsArray" value=$storymodel->getPremiumStory(0, $list.feedItems)%>
								<%elseif $list.feedType == "audiovideo"%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="itemsArray" value=$videomodel->get_video_audio(0,$list.feedItems,40,10800)%>
								<%/if%>
							<%else%>
								<%if $list.feedType == "story"%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="itemsArray" value=$storymodel->get_story_by_tag($list.feedTag,0,$list.feedItems)%>
								<%elseif $list.feedType == "interactive"%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="itemsArray" value=$interactivemodel->get_interactive_by_tag($list.feedTag, $list.feedItems)%>
								<%elseif $list.feedType == "aiaudio"%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="itemsArray" value=$interactivemodel->get_ai_audios($list.language, $list.feedStart, $list.feedItems)%>
								<%elseif $list.feedType == "video"%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="itemsArray" value=$videomodel->get_video_by_tag($list.feedTag,0,$list.feedItems)%>
								<%elseif $list.feedType == "photo"%>
									<%assign var="feedType" value="photonews"%>
									<%assign var="itemsArray" value=$photonewsmodel->get_photonews_by_tag($list.feedTag,0,$list.feedItems)%>
								<%elseif $list.feedType == "premium"%>
									<%*<!--Premium Content Should Display -->*%>
									<%assign var="feedType" value=$list.feedType%>
									<!--<%*assign var="itemsArray" value=$storymodel->getContentByTag("FT独家",$feedItems)*%>-->
									<%assign var="itemsArray" value=$storymodel->getPremiumStory(0, $list.feedItems)%>
								<%elseif $list.feedType == "audiovideo"%>
									<%*<!--Premium Content Should Display -->*%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="itemsArray" value=$videomodel->get_video_audio(0,$list.feedItems,40,10800)%>
								<%else%>
									<%assign var="feedType" value=$list.feedType%>
									<%assign var="itemsArray" value=$storymodel->getContentByTag($list.feedTag,$list.feedItems)%>
								<%/if%>
							<%/if%>
						<%else%>
							<%assign var="feedType" value="manual"%>
							<%assign var="itemsArray" value=$list.items%>
						<%/if%>  <%*<!--end <%if $list.items|@count==0 && -->*%>
						<%assign var="i" value=0%>
						<%*<!--start foreach $itemsArray -->*%>
						<%foreach from=$itemsArray item=item%>
							<%assign var="itemHeadline" value=$item.headline|default:$item.cheadline|default:$item.cn_title%>
							<%if $feedType == "all"%>
								<%assign var="itemImage" value=$item.image.cover|default:$item.image.smallbutton|default:$item.image.other|default:$item.image.bigbutton%>
							<%elseif $feedType == "photonews"%>
								<%assign var="itemImage" value=$item.illustration|default:$item.cover|default:$item.thumb_url%>
								<%if $itemImage != ""%>
									<%assign var="itemImage" value="https://thumbor.ftacademy.cn/unsafe/`$itemImage`"%>
								<%/if%>
							<%else%>
								<%assign var="itemImage" value=$item.image|default:$item.story_pic.cover|default:$item.story_pic.smallbutton|default:$item.story_pic.other|default:$item.story_pic.bigbutton%>
							<%/if%>
							<%assign var="itemImage" value=$itemImage|replace:"http://i.ftimg.net/picture/":"https://thumbor.ftacademy.cn/unsafe/picture/"%>
							<%assign var="itemType" value=$item.type|default:$feedType%>
							<%if $itemType == "photo"%>
								<%assign var="itemType" value="photonews"%>
							<%/if%>
							<%assign var="itemId" value=$item.id|default:$item.photonewsid%>
							<%assign var="itemClass" value=""%>
							<%assign var="hasImage" value="has-image"%>
							<%assign var="hideImage" value="no"%>
							<%assign var="hideLead" value="no"%>
							<%if $i===0%>
								<%assign var="itemClass" value="first"%>
							<%elseif $list.sideOption == "BigImageAndLead"%>
								<%assign var="itemClass" value="big-image"%>
							<%/if%>
							<%if $list.preferLead === "none"%>
								<%assign var="hideLead" value="yes"%>
								<%assign var="itemLead" value=""%>
							<%elseif $list.preferLead === "shortlead"%>
								<%assign var="itemLead" value=$item.shortlead|default:$item.longlead|default:$item.cshortleadbody|default:$item.clongleadbody%>
							<%else%>
								<%assign var="itemLead" value=$item.longlead|default:$item.shortlead|default:$item.clongleadbody|default:$item.cshortleadbody%>
							<%/if%>

							<%if $hideImage === "yes"%>
								<%assign var="hasImage" value="no-image"%>
							<%/if%>

							<%if $list.sideOption == "headlineOnly" || $list.sideOption == "MachineTranslation"%>
								<%assign var="hasImage" value="no-image"%>
								<%if $i == 0%>
									<%assign var="itemClass" value="first-headline"%>
								<%else%>
									<%assign var="itemClass" value=""%>
								<%/if%>
							<%/if%>


							<%if $list.sideOption == "headShot"%>
								<%if $i == 0%>
									<%assign var="itemClass" value="first-headline"%>
								<%/if%>
							<%/if%>
							

							<%if $item.customLink != "" %>
								<%assign var="itemLink" value=$item.customLink%>
								<%assign var="itemLink" value=" href=\"`$itemLink`\""%>
							<%elseif $itemId == "" || $itemType == "" %>
								<%assign var="itemLink" value=""%>
							<%else%>
								<%assign var="itemLink" value="/`$itemType`/`$itemId``$adForceString`"%>
								<%assign var="itemLink" value=" href=\"`$itemLink`\""%>
							<%/if%>

							<%if $smarty.get.webview == "ftcapp"%>
								<%if preg_match("/.mp3$/is",$item.shortlead) || preg_match("/.mp3$/is",$item.cshortleadbody)%>
									<%assign var="audioUrl" value=$item.shortlead|default:$item.cshortleadbody%>
									<%assign var="audioData" value=" data-audio=\"`$audioUrl`\""%>
								<%else%>
									<%assign var="audioUrl" value=""%>
									<%assign var="audioData" value=""%>
								<%/if%>
								<%assign var="itemData" value=" data-id=\"`$item.id`\" data-type=\"`$itemType`\"`$audioData`"%>
								<%if $item.id == "" || $itemType == "manual" || $itemType == "third-party-iframe"%>
									<%assign var="itemData" value=""%>
								<%else%>
									<%assign var="itemClass" value="`$itemClass` item-container-app"%>
								<%/if%>
							<%/if%>

							<div class="item-container <%$itemClass%> <%$hasImage%>"<%$itemData%>><div class="item-inner">
								<%if $itemType === "widget"%>
									<%include file="widgets/`$itemHeadline`"%>
								<%elseif $list.sideOption == "imageAndLead" || $list.sideOption == "BigImageAndLead"%>
									<%if $itemImage != "" && $hasImage === "has-image"%><a class="image" target="_blank"<%$itemLink%>><figure class="loading" data-url="<%$itemImage|replace:"/upload/":"/"%>"></figure></a><%/if%>
									<%if $itemHeadline != ""%>
										<h2 class="item-headline"><%$itemTag%><a target="_blank" class="<%$lockClass%>" <%$itemLink%>><%$itemHeadline%></a></h2>
									<%/if%>
									<div class="item-lead item-description"><%$itemLead|nl2br%></div>
								<%elseif $list.sideOption == "originalImage"%>
									<style>
										.is-original img {
											margin: 0 auto;
											display: block;
										}
									</style>
									<%if $itemImage != "" && $hasImage === "has-image"%><a class="image is-original" target="_blank"<%$itemLink%>><img src="<%$itemImage|replace:"/upload/":"/"%>"></a><%/if%>
								<%elseif $list.sideOption == "barcode"%>
									<style>
									.is-barcode figure {
									    width: 200px;
									    height: 200px;
									    padding-bottom: 0;
									    margin:auto;
									}
									</style>
									<%if $itemImage != "" && $hasImage === "has-image"%><div class="image is-barcode" target="_blank"<%$itemLink%>><figure class="loading" data-url="<%$itemImage|replace:"/upload/":"/"%>"></figure></div><%/if%>
								<%elseif $list.sideOption == "leadOnly"%>
									<div class="item-lead item-description"><%$itemLead|nl2br%></div>
								<%elseif $list.sideOption == "headShot"%>
									<%if $itemImage != "" && $hasImage === "has-image"%>
										<a class="image portrait-img portrait-img-right" target="_blank"<%$itemLink%>><figure class="loading" data-url="<%$itemImage|replace:"/upload/":"/"%>"></figure></a>
									<%/if%>	
									<%if $itemHeadline != ""%>
									<div class="item-headline-lead-right">
									<h2 class="item-headline <%$lockClass%>"><%$itemTag%><a target="_blank"<%$itemLink%>><%$itemHeadline%></a></h2>
									<div class="item-lead"><%$itemLead|nl2br%></div>
									</div>
									<div class=clearfloat></div>
									<%/if%>	
								<%elseif $list.sideOption == "MachineTranslation"%>
									<%assign var="itemHeadline" value=$item.eheadline%>
									<%assign var="itemLead" value=$item.cheadline|regex_replace:"/\-\|\-.*$/":""%>
									<h2 class="item-headline <%$lockClass%>"><a target="_blank"<%$itemLink%>><%$itemHeadline%></a></h2>
									<div class="item-lead item-subheadline"><%$itemLead|nl2br%></div>
								<%else%>
									<%if $itemImage != "" && $hasImage === "has-image"%><a class="image" target="_blank"<%$itemLink%>><figure class="loading" data-url="<%$itemImage|replace:"/upload/":"/"%>"></figure></a><%/if%>
									<%if $itemHeadline != ""%>
										<h2 class="item-headline <%$lockClass%>"><%$itemTag%><a target="_blank"<%$itemLink%>><%$itemHeadline%></a></h2>
									<%/if%>									
								<%/if%>
							</div><%*<!--end item-inner -->*%>
							</div><%*<!--end class="item-container -->*%>
							<%assign var="i" value=$i+1%>
						<%/foreach%>  <%*<!--end foreach $itemsArray-->*%>
					</div>  <%*<!--end class="side-list-->*%>
					<%assign var="s" value=$s+1%>
				<%/if%>  <%*<!--end $list.type == "SideWithItems"-->*%>
			<%/foreach%>  <%*<!--end foreach $section.lists -->*%>	
		</div>  <%*<!--end <div class="side-inner"> -->*%>
		</div>  <%*<!--end <div class="side-container"> -->*%>
	<%elseif $section.side != "" && $section.side != "none"%>
		<%include file="next/partials/`$section.side`.html"%>
	<%/if%>
	<div class="clearfloat"></div>
</div> <%*<!--end class="block-inner" -->*%>
</div> <%*<!--end class="block-container -->*%>


<%*<!--MARK: - Current smarty doesn't support global scope. So set the myft-display.js here.  -->*%>
<%if $isMyFTOn == "yes"%>
    <script type="text/javascript">
        <%include file = "next/scripts/myft-display.js"%>
    </script>
<%/if%>
<%*<!--MARK: - Support Bilingual Full Text such as Coronavirus Latest -->*%>
<%if $listHasFloat == "BiligualFullText"%>
	<script type="text/javascript">
        <%include file="next/scripts/main-bilingual-full-text.js"%>
    </script>
<%/if%>